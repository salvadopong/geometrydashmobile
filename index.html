<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Dash Play Online</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            /* EXTREMELY FLASHY/VIVID COLORS */
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff00;
            --neon-yellow: #ffff00;
            --neon-orange: #ff8800;
            --neon-purple: #ff00ff;
            --neon-red: #ff0066;
            --accent-green: #33ff00;
            --bg-dark: #000011;
            --ui-bg: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(0,20,40,0.95) 100%);
            --border-glow: 0 0 20px currentColor;
            --player-main: var(--neon-blue);
            --player-sec: var(--neon-pink);
        }

        body {
            background: var(--bg-dark);
            margin: 0;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            user-select: none;
            cursor: default;
        }

        canvas {
            display: block;
        }

        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: radial-gradient(circle at center, rgba(0,255,255,0.1) 0%, transparent 70%);
        }

        .hidden { 
            opacity: 0; 
            pointer-events: none;
            transform: scale(1.1);
        }
        .visible { 
            opacity: 1; 
            pointer-events: auto;
            transform: scale(1);
        }

        .menu-box {
            background: var(--ui-bg);
            border: 3px solid var(--neon-blue);
            box-shadow: 
                0 0 30px var(--neon-blue),
                inset 0 0 20px var(--neon-blue),
                0 0 60px rgba(0, 255, 255, 0.3);
            padding: 60px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(15px);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            animation: pulse-glow 2s infinite alternate;
            position: relative;
        }

        .menu-box::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green), var(--neon-yellow));
            border-radius: 25px;
            z-index: -1;
            animation: rotate-gradient 3s linear infinite;
            opacity: 0.7;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 30px var(--neon-blue), inset 0 0 20px var(--neon-blue), 0 0 60px rgba(0, 255, 255, 0.3); }
            100% { box-shadow: 0 0 50px var(--neon-pink), inset 0 0 30px var(--neon-pink), 0 0 80px rgba(255, 0, 255, 0.5); }
        }

        @keyframes rotate-gradient {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        h1 {
            color: transparent;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green));
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 30px currentColor;
            font-size: 4em;
            margin-bottom: 30px;
            font-weight: 900;
            letter-spacing: 3px;
            animation: text-shimmer 3s ease-in-out infinite alternate;
        }

        @keyframes text-shimmer {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        h2 {
            color: transparent;
            background: linear-gradient(45deg, var(--neon-yellow), var(--neon-orange));
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 20px currentColor;
            font-size: 2.8em;
            margin-bottom: 30px;
            font-weight: 700;
        }

        button, .lvl-btn {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,20,40,0.8) 100%);
            color: var(--neon-blue);
            border: 2px solid var(--neon-blue);
            padding: 18px 35px;
            margin: 15px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 1.3em;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--border-glow);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
        }

        button::before, .lvl-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before, .lvl-btn:hover::before {
            left: 100%;
        }

        button:hover:not(:disabled), .lvl-btn.unlocked:hover {
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-pink) 100%);
            color: #000;
            box-shadow: 0 0 40px var(--neon-blue), 0 0 80px var(--neon-pink);
            transform: translateY(-3px) scale(1.05);
            border-color: transparent;
        }

        button.pink, button.next {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
            box-shadow: var(--border-glow);
        }

        button.pink:hover, button.next:hover {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
            color: #000;
            box-shadow: 0 0 40px var(--neon-pink), 0 0 80px var(--neon-purple);
        }

        button.green {
            border-color: var(--neon-green);
            color: var(--neon-green);
            box-shadow: var(--border-glow);
        }

        button.green:hover {
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--neon-blue) 100%);
            color: #000;
            box-shadow: 0 0 40px var(--neon-green), 0 0 80px var(--neon-blue);
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: none;
            padding: 20px;
            box-sizing: border-box;
            z-index: 50;
            color: var(--neon-blue);
            text-shadow: 0 0 10px currentColor;
            font-weight: 700;
        }

        #prog-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }

        #prog {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-blue));
            transition: width 0.1s linear;
            box-shadow: 0 0 20px var(--accent-green);
            position: relative;
        }

        #prog::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 1.5s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .hud-stats {
            position: absolute;
            top: 20px;
            left: 25px;
            font-size: 1.4em;
            font-weight: 900;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--neon-blue);
            box-shadow: var(--border-glow);
        }
        .hud-stats span { 
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink);
        }

        .hud-progress {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.4em;
            font-weight: 900;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--neon-green);
            box-shadow: var(--border-glow);
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        #msg, #tutorial-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            color: transparent;
            background: linear-gradient(45deg, var(--neon-green), var(--neon-yellow), var(--neon-orange));
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 30px currentColor;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            text-align: center;
            font-weight: 900;
            animation: text-pulse 2s infinite;
        }

        @keyframes text-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        #tutorial-msg {
            font-size: 2.2em;
            top: 25%;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Level Grid */
        #lvl-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 25px;
            margin-top: 40px;
            max-width: 800px;
        }
        
        .lvl-btn {
            width: 90px;
            height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            margin: 0;
            border-radius: 20px;
            font-weight: 900;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .lvl-btn.unlocked {
            background: linear-gradient(135deg, rgba(0,255,255,0.2), rgba(255,0,255,0.2));
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .lvl-btn.unlocked:hover {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-pink));
            transform: rotate(5deg) scale(1.1);
            box-shadow: 0 0 40px var(--neon-blue), 0 0 60px var(--neon-pink);
        }

        .lvl-btn.locked {
            background: rgba(0, 0, 0, 0.5);
            border-color: #666;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.5;
        }

        /* Shop UI */
        #shop-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            margin-top: 40px;
            max-width: 1000px;
            max-height: 700px;
            overflow-y: auto;
            padding: 20px;
        }

        .costume-item {
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,20,40,0.8) 100%);
            border: 3px solid var(--border-color);
            padding: 25px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-size: 1.1em;
            position: relative;
            overflow: hidden;
        }

        .costume-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green), var(--neon-yellow));
            border-radius: 22px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .costume-item:hover::before {
            opacity: 1;
        }

        .costume-item:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .costume-item.unlocked {
            border-color: var(--neon-green);
            box-shadow: 0 0 20px var(--neon-green);
        }
        
        .costume-item.equipped {
            border-color: var(--neon-pink);
            box-shadow: 0 0 30px var(--neon-pink), inset 0 0 20px var(--neon-pink);
        }

        .costume-preview {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            background: rgba(0,0,0,0.5);
            border: 2px solid currentColor;
        }

        .player-preview-cube {
            width: 50px;
            height: 50px;
            border: 4px solid;
            position: relative;
            border-radius: 8px;
        }

        .cost {
            margin-top: 12px;
            color: var(--neon-pink);
            font-weight: bold;
            text-shadow: 0 0 8px var(--neon-pink);
            font-size: 1.2em;
        }

        /* Mobile Controls */
        #mobile-controls {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 150px;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .show-mobile #mobile-controls {
            display: flex;
        }

        .mobile-btn {
            background: linear-gradient(135deg, rgba(0,255,255,0.3), rgba(255,0,255,0.3));
            border: 3px solid var(--neon-blue);
            color: var(--neon-blue);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            opacity: 0.9;
            box-shadow: 0 0 30px var(--neon-blue);
            touch-action: manipulation;
            transition: all 0.2s;
        }

        .mobile-btn:active {
            transform: scale(0.9);
            box-shadow: 0 0 50px var(--neon-pink);
        }

        /* Level Editor Styles */
        #editor-tools {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--ui-bg);
            border-top: 3px solid var(--neon-blue);
            padding: 15px;
            display: none;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            z-index: 200;
            box-shadow: 0 -5px 30px rgba(0,255,255,0.3);
        }

        .editor-tool {
            width: 60px;
            height: 60px;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s;
        }

        .editor-tool:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .editor-tool.selected {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 25px var(--neon-blue);
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }

        .editor-btn {
            padding: 10px 20px;
            font-size: 1em;
        }

        /* Particle Effects */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }

        /* Screen Transition */
        .screen-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--neon-blue);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
        }

        .transition-active {
            opacity: 1;
        }
        
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div id="hud">
        <div class="hud-stats">
            Att: <span id="att">1</span><br>
            Coins: <span id="coin-count-val">0</span>
        </div>
        <div class="hud-progress">
            <span id="progress-percent">0%</span>
        </div>
        <div id="prog-bar"><div id="prog"></div></div>
        <div id="msg">CUBE</div>
        <div id="tutorial-msg" style="display:none;"></div>
    </div>
    
    <div id="menu-main" class="ui-layer visible">
        <div class="menu-box">
            <h1>NEON DASH</h1>
            <p style="font-size: 1.3em; color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green);">Levels unlocked: <span id="unlock-count">1</span>/50</p>
            <p style="font-size: 1.5em; color: var(--neon-yellow); text-shadow: 0 0 10px var(--neon-yellow);">Coins: <span id="menu-coins">0</span> üí∞</p>
            <button onclick="UI.startPlay()" class="green">PLAY</button>
            <button class="pink" onclick="UI.showShop()">CUSTOMIZE</button>
            <button class="pink" onclick="UI.showEditor()">LEVEL EDITOR</button>
        </div>
    </div>

    <div id="menu-levels" class="ui-layer hidden">
        <div class="menu-box">
            <h2>SELECT LEVEL</h2>
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                <button id="level-prev" onclick="UI.changeLevelPage(-1)">‚Üê</button>
                <div id="lvl-grid"></div>
                <button id="level-next" onclick="UI.changeLevelPage(1)">‚Üí</button>
            </div>
            <button onclick="UI.home()">BACK TO MENU</button>
        </div>
    </div>

    <div id="menu-shop" class="ui-layer hidden">
        <div class="menu-box">
            <h2>CUSTOMIZE</h2>
            <p style="font-size: 1.5em; color: var(--neon-yellow); text-shadow: 0 0 10px var(--neon-yellow);">Your Coins: <span id="shop-coins">0</span> üí∞</p>
            <div id="shop-content"></div>
            <button id="shop-back-btn" onclick="UI.home()">BACK</button>
        </div>
    </div>

    <div id="menu-pause" class="ui-layer hidden">
        <div class="menu-box">
            <h2 id="pause-title">PAUSED</h2>
            <p id="pause-p" style="color: var(--neon-yellow);">Press R to Retry</p>
            <button id="pause-main-btn" onclick="Game.retry()">RETRY (R Key)</button>
            <button class="pink" onclick="UI.home()">RETURN TO MENU</button>
        </div>
    </div>

    <div id="menu-editor" class="ui-layer hidden">
        <div class="menu-box">
            <h2>LEVEL EDITOR</h2>
            <p style="color: var(--neon-yellow);">Create your own levels!</p>
            <button onclick="LevelEditor.startNew()" class="green">NEW LEVEL</button>
            <button onclick="LevelEditor.load()" class="pink">LOAD LEVEL</button>
            <button onclick="UI.home()">BACK TO MENU</button>
        </div>
    </div>

    <div id="game-container">
        <div id="mobile-controls">
            <button class="mobile-btn" 
                ontouchstart="Input.touchStartAction(event)" 
                ontouchend="Input.touchEndAction(event)">
                ‚¨ÜÔ∏è
            </button>
        </div>
    </div>

    <!-- Level Editor Tools -->
    <div id="editor-tools">
        <div class="editor-tool selected" data-type="1">‚¨ú</div>
        <div class="editor-tool" data-type="2">üî∫</div>
        <div class="editor-tool" data-type="3">üü°</div>
        <div class="editor-tool" data-type="7">üîµ</div>
        <div class="editor-tool" data-type="4">üöÄ</div>
        <div class="editor-tool" data-type="5">üõ∏</div>
        <div class="editor-tool" data-type="11">üåä</div>
        <div class="editor-tool" data-type="12">ü§ñ</div>
        <div class="editor-tool" data-type="14">üîÑ</div>
        <div class="editor-tool" data-type="15">üí®</div>
        <div class="editor-tool" data-type="16">üêå</div>
        <div class="editor-tool" data-type="9">üìè</div>
        <div class="editor-tool" data-type="10">üìê</div>
        <div class="editor-tool" data-type="13">üíæ</div>
        <div class="editor-tool" data-type="20">üîÑ</div>
        <div class="editor-tool" data-type="99">üéØ</div>
        <div class="editor-controls">
            <button class="editor-btn green" onclick="LevelEditor.save()">SAVE</button>
            <button class="editor-btn pink" onclick="LevelEditor.exportLevel()">EXPORT</button>
            <button class="editor-btn" onclick="LevelEditor.importLevel()">IMPORT</button>
            <button class="editor-btn" onclick="LevelEditor.clearLevel()">CLEAR</button>
            <button class="editor-btn" onclick="LevelEditor.exitEditor()">EXIT</button>
        </div>
    </div>

    <!-- Screen Transition Overlay -->
    <div id="screen-transition" class="screen-transition"></div>

<script>
// --- CONFIG & GLOBALS ---
const CFG = {
    tile: 50,
    spd: 8.5,
    jmp: 27, // Increased jump height
    g: 0.9,
    term: 20,
    START_X: 6,
    maxHeight: -400, // 8 blocks high (8 * 50 = 400)
    PAD_JUMP: 80,
    DASH_DIST: 200,
    DASH_COLOR: '#ff0000',
    SLOW_FACTOR: 0.5,
    SLOW_DURATION: 1000,
    MINI_SCALE: 0.6,
    MACRO_SCALE: 1.0,
    TOTAL_LEVELS: 50,
    LEVELS_PER_PAGE: 10,
    SPIKE_HEIGHT: 8, // 8 block height limit
    FLYING_SPIKE_ZONE: 8 * 50, // 8 blocks in pixels
    GRAVITY_BLOCK_HEIGHT: 150
};

let unlocked = parseInt(localStorage.getItem('nd_level') || 1);
let totalCoins = parseInt(localStorage.getItem('nd_coins') || 0);
let equippedSkinIndex = parseInt(localStorage.getItem('nd_equipped_skin') || 0);
let unlockedSkins = JSON.parse(localStorage.getItem('nd_skins') || '[0]');
let tutorialDone = localStorage.getItem('nd_tutorial_done') === 'true';
let currentPage = 1;

const THEMES = [
    ['C4', 200, 100],
    ['A4', 120, 90],
    ['F4', 300, 90],
    ['D4', 40, 95],
    ['G4', 0, 90]
];

// --- INPUT ---
const Input = { 
    held: false, 
    mousePressed: false,
    mouseX: 0,
    mouseY: 0
};

const SKINS = [
    { name: 'Neon Blue', main: '#00ffff', secondary: '#ff0088', cost: 0 },
    { name: 'Matrix Green', main: '#33ff00', secondary: '#ff8800', cost: 50 },
    { name: 'Lava', main: '#ff4d00', secondary: '#ffff00', cost: 100 },
    { name: 'Royal Purple', main: '#d000ff', secondary: '#ff00d0', cost: 150 },
    { name: 'Dark Ops', main: '#333333', secondary: '#ffffff', cost: 200 },
    { name: 'Season 1 Skin', main: '#ff00ff', secondary: '#00ffff', cost: 400 }
];

// --- AUDIO ENGINE ---
const AUDIO = {
    ctx: new (window.AudioContext || window.webkitAudioContext)(),
    bgmOsc: null,
    
    init: function() {
        if (this.ctx.state === 'suspended') {
            this.ctx.resume();
        }
    },

    playTone: function(freq, type, duration = 0.1, volume = 0.5) {
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();

        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(volume, this.ctx.currentTime);

        osc.connect(gain);
        gain.connect(this.ctx.destination);

        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime + duration);
        osc.stop(this.ctx.currentTime + duration);
    },

    startBGM: function(freq = 'C4') {
        this.stopBGM();
        
        const noteMap = {
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
            'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25
        };
        const f = noteMap[freq] || noteMap['C4'];

        this.bgmOsc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        gain.gain.setValueAtTime(0.1, this.ctx.currentTime);

        this.bgmOsc.type = 'sawtooth';
        this.bgmOsc.frequency.setValueAtTime(f, this.ctx.currentTime);

        this.bgmOsc.connect(gain);
        gain.connect(this.ctx.destination);
        this.bgmOsc.start();
    },

    stopBGM: function() {
        if (this.bgmOsc) {
            this.bgmOsc.stop(this.ctx.currentTime);
            this.bgmOsc = null;
        }
    },

    jump: () => AUDIO.playTone(880, 'sine', 0.08, 0.4),
    pad: () => AUDIO.playTone(1320, 'square', 0.1, 0.5),
    coin: () => AUDIO.playTone(1000, 'triangle', 0.05, 0.3),
    gravity: () => AUDIO.playTone(1800, 'sawtooth', 0.1, 0.5),
    die: () => AUDIO.playTone(100, 'square', 0.3, 0.6),
    win: () => AUDIO.playTone(1500, 'sine', 0.4, 0.7),
    dash: () => AUDIO.playTone(1600, 'square', 0.08, 0.6),
    slow: () => AUDIO.playTone(500, 'triangle', 0.1, 0.4),
    checkpoint: () => AUDIO.playTone(1200, 'sine', 0.15, 0.4),
};

// --- LEVEL DATA (COMPLETELY REDESIGNED WITH OBSTACLES THROUGHOUT) ---
const L = (t, x, y) => ({ t: t, x: x, y: y });

const createLevel = (id, objects) => {
    objects.push(L(99, 250, 0)); // Extended goal position
    return objects;
}

// Level 0: CUBE - Basic Introduction
const LEVELS = [
    createLevel(0, [
        L(1,10,0), L(1,14,0), L(1,18,0), L(1,22,0), L(1,26,0), L(7,30,0), L(1,34,0), L(1,38,0), L(7,42,0),
        L(2,46,0), L(1,50,0), L(2,54,0), L(1,58,0), L(7,62,0), L(1,66,0), L(1,70,0), L(1,74,0), L(7,78,0),
        L(1,82,0), L(1,86,0), L(1,90,2), L(1,94,2), L(1,98,2), L(7,102,0), L(1,106,0), L(1,110,0), L(7,114,0),
        L(2,118,0), L(2,122,0), L(2,126,0), L(1,130,0), L(1,134,0), L(7,138,0), L(1,142,0), L(1,146,0),
        L(1,150,0), L(2,154,0), L(1,158,0), L(1,162,0), L(7,166,0), L(1,170,0), L(1,174,0), L(1,178,0),
        L(2,182,0), L(1,186,0), L(1,190,0), L(1,194,0), L(7,198,0), L(1,202,0), L(1,206,0), L(1,210,0),
        L(2,214,0), L(1,218,0), L(1,222,0), L(1,226,0), L(7,230,0), L(1,234,0), L(1,238,0), L(1,242,0),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0), L(3,76,0),
        L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0), L(3,140,0),
        L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0), L(3,204,0),
        L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 1: CUBE - 4 BLOCK GAPS with obstacles throughout
    createLevel(1, [
        L(1,10,0), L(1,14,0), L(1,18,0), L(1,22,0), L (1,20,0),
        L(1,26,0), L(1,30,0), L(1,34,0), L(1,38,0),
        L(1,42,0), L(1,46,0), L(1,50,0), L(1,54,0),
        L(1,58,0), L(1,62,0), L(1,66,0), L(1,70,0),
        L(1,74,0), L(1,78,0), L(1,82,0), L(1,86,0),
        L(1,90,0), L(1,94,0), L(1,98,0), L(1,102,0),
        L(1,106,0), L(1,110,0), L(1,114,0), L(1,118,0),
        L(1,122,0), L(1,126,0), L(1,130,0), L(1,134,0),
        L(1,138,0), L(1,142,0), L(1,146,0), L(1,150,0),
        L(1,154,0), L(1,158,0), L(1,162,0), L(1,166,0),
        L(1,170,0), L(1,174,0), L(1,178,0), L(1,182,0),
        L(1,186,0), L(1,190,0), L(1,194,0), L(1,198,0),
        L(1,202,0), L(1,206,0), L(1,210,0), L(1,214,0),
        L(1,218,0), L(1,222,0), L(1,226,0), L(1,230,0),
        L(1,234,0), L(1,238,0), L(1,242,0), L(1,246,0),
        // 4-block gaps created by removing blocks
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0),
        // Additional obstacles throughout
        L(2,15,0), L(2,25,0), L(2,35,0), L(2,45,0), L(2,55,0), L(2,65,0), L(2,75,0), L(2,85,0),
        L(2,95,0), L(2,105,0), L(2,115,0), L(2,125,0), L(2,135,0), L(2,145,0), L(2,155,0), L(2,165,0),
        L(2,175,0), L(2,185,0), L(2,195,0), L(2,205,0), L(2,215,0), L(2,225,0), L(2,235,0), L(2,245,0)
    ]),

    // Level 2: SHIP - Flying Chaos with obstacles throughout
    createLevel(2, [
        L(4,10,2), 
        L(2,15,0), L(2,20,0), L(2,25,0), L(2,30,0), L(2,35,0), L(2,40,0), L(2,45,0), L(2,50,0),
        L(2,15,8), L(2,20,8), L(2,25,8), L(2,30,8), L(2,35,8), L(2,40,8), L(2,45,8), L(2,50,8),
        L(1,55,0), L(1,55,4), L(2,60,1), L(2,60,3), L(1,65,0), L(1,65,4), L(2,70,1), L(2,70,3),
        L(1,75,0), L(1,75,4), L(2,80,1), L(2,80,3), L(1,85,0), L(1,85,4), L(2,90,1), L(2,90,3),
        L(1,95,0), L(1,95,4), L(2,100,1), L(2,100,3), L(1,105,0), L(1,105,4), L(2,110,1), L(2,110,3),
        L(1,115,0), L(1,115,4), L(2,120,1), L(2,120,3), L(1,125,0), L(1,125,4), L(2,130,1), L(2,130,3),
        L(1,135,0), L(1,135,4), L(2,140,1), L(2,140,3), L(1,145,0), L(1,145,4), L(2,150,1), L(2,150,3),
        L(1,155,0), L(1,155,4), L(2,160,1), L(2,160,3), L(1,165,0), L(1,165,4), L(2,170,1), L(2,170,3),
        L(1,175,0), L(1,175,4), L(2,180,1), L(2,180,3), L(1,185,0), L(1,185,4), L(2,190,1), L(2,190,3),
        L(1,195,0), L(1,195,4), L(2,200,1), L(2,200,3), L(1,205,0), L(1,205,4), L(2,210,1), L(2,210,3),
        L(1,215,0), L(1,215,4), L(2,220,1), L(2,220,3), L(1,225,0), L(1,225,4), L(2,230,1), L(2,230,3),
        L(1,235,0), L(1,235,4), L(2,240,1), L(2,240,3), L(1,245,0), L(1,245,4),
        L(3,12,2), L(3,22,2), L(3,32,2), L(3,42,2), L(3,52,2), L(3,62,2), L(3,72,2), L(3,82,2),
        L(3,92,2), L(3,102,2), L(3,112,2), L(3,122,2), L(3,132,2), L(3,142,2), L(3,152,2), L(3,162,2),
        L(3,172,2), L(3,182,2), L(3,192,2), L(3,202,2), L(3,212,2), L(3,222,2), L(3,232,2), L(3,242,2)
    ]),

    // Level 3: UFO - Precision Madness with obstacles throughout
    createLevel(3, [
        L(5,10,2), L(16,14,2), L(1,18,0), L(1,20,0), L(1,22,0), L(1,26,2), L(1,28,2), L(1,30,2), L(16,34,2),
        L(1,38,0), L(1,40,0), L(1,42,0), L(1,46,2), L(1,48,2), L(1,50,2), L(16,54,2), L(1,58,0), L(1,60,0),
        L(1,62,0), L(1,66,2), L(1,68,2), L(1,70,2), L(16,74,2), L(1,78,0), L(1,80,0), L(1,82,0), L(1,86,2),
        L(1,88,2), L(1,90,2), L(16,94,2), L(1,98,0), L(1,100,0), L(1,102,0), L(1,106,2), L(1,108,2), L(1,110,2),
        L(16,114,2), L(1,118,0), L(1,120,0), L(1,122,0), L(1,126,2), L(1,128,2), L(1,130,2), L(16,134,2),
        L(1,138,0), L(1,140,0), L(1,142,0), L(1,146,2), L(1,148,2), L(1,150,2), L(16,154,2), L(1,158,0),
        L(1,160,0), L(1,162,0), L(1,166,2), L(1,168,2), L(1,170,2), L(16,174,2), L(1,178,0), L(1,180,0),
        L(1,182,0), L(1,186,2), L(1,188,2), L(1,190,2), L(16,194,2), L(1,198,0), L(1,200,0), L(1,202,0),
        L(1,206,2), L(1,208,2), L(1,210,2), L(16,214,2), L(1,218,0), L(1,220,0), L(1,222,0), L(1,226,2),
        L(1,228,2), L(1,230,2), L(16,234,2), L(1,238,0), L(1,240,0), L(1,242,0), L(1,246,2), L(1,248,2),
        L(3,13,2), L(3,21,2), L(3,29,2), L(3,37,2), L(3,45,2), L(3,53,2), L(3,61,2), L(3,69,2),
        L(3,77,2), L(3,85,2), L(3,93,2), L(3,101,2), L(3,109,2), L(3,117,2), L(3,125,2), L(3,133,2),
        L(3,141,2), L(3,149,2), L(3,157,2), L(3,165,2), L(3,173,2), L(3,181,2), L(3,189,2), L(3,197,2),
        L(3,205,2), L(3,213,2), L(3,221,2), L(3,229,2), L(3,237,2), L(3,245,2)
    ]),

    // Level 4: WAVE - Extreme Waves with obstacles throughout
    createLevel(4, [
        L(11,10,2),
        L(2,15,0), L(2,20,0), L(2,25,0), L(2,30,0), L(2,35,0), L(2,40,0), L(2,45,0), L(2,50,0),
        L(2,15,8), L(2,20,8), L(2,25,8), L(2,30,8), L(2,35,8), L(2,40,8), L(2,45,8), L(2,50,8),
        L(2,55,1), L(2,55,3), L(1,60,0), L(1,60,4), L(2,65,1), L(2,65,3), L(1,70,0), L(1,70,4),
        L(2,75,1), L(2,75,3), L(1,80,0), L(1,80,4), L(2,85,1), L(2,85,3), L(1,90,0), L(1,90,4),
        L(2,95,1), L(2,95,3), L(1,100,0), L(1,100,4), L(2,105,1), L(2,105,3), L(1,110,0), L(1,110,4),
        L(2,115,1), L(2,115,3), L(1,120,0), L(1,120,4), L(2,125,1), L(2,125,3), L(1,130,0), L(1,130,4),
        L(2,135,1), L(2,135,3), L(1,140,0), L(1,140,4), L(2,145,1), L(2,145,3), L(1,150,0), L(1,150,4),
        L(2,155,1), L(2,155,3), L(1,160,0), L(1,160,4), L(2,165,1), L(2,165,3), L(1,170,0), L(1,170,4),
        L(2,175,1), L(2,175,3), L(1,180,0), L(1,180,4), L(2,185,1), L(2,185,3), L(1,190,0), L(1,190,4),
        L(2,195,1), L(2,195,3), L(1,200,0), L(1,200,4), L(2,205,1), L(2,205,3), L(1,210,0), L(1,210,4),
        L(2,215,1), L(2,215,3), L(1,220,0), L(1,220,4), L(2,225,1), L(2,225,3), L(1,230,0), L(1,230,4),
        L(2,235,1), L(2,235,3), L(1,240,0), L(1,240,4), L(2,245,1), L(2,245,3),
        L(3,12,2), L(3,22,2), L(3,32,2), L(3,42,2), L(3,52,2), L(3,62,2), L(3,72,2), L(3,82,2),
        L(3,92,2), L(3,102,2), L(3,112,2), L(3,122,2), L(3,132,2), L(3,142,2), L(3,152,2), L(3,162,2),
        L(3,172,2), L(3,182,2), L(3,192,2), L(3,202,2), L(3,212,2), L(3,222,2), L(3,232,2), L(3,242,2)
    ]),

    // Level 5: ROBOT/MINI - Tiny Jumps with obstacles throughout
    createLevel(5, [
        L(12,10,0), L(9,14,2), L(1,18,0), L(1,22,2), L(1,26,0), L(1,30,2), L(1,34,0), L(1,38,2), L(1,42,0),
        L(1,46,2), L(1,50,0), L(1,54,2), L(1,58,0), L(1,62,2), L(1,66,0), L(1,70,2), L(1,74,0), L(1,78,2),
        L(1,82,0), L(1,86,2), L(1,90,0), L(1,94,2), L(1,98,0), L(1,102,2), L(1,106,0), L(1,110,2), L(1,114,0),
        L(1,118,2), L(1,122,0), L(1,126,2), L(1,130,0), L(1,134,2), L(1,138,0), L(1,142,2), L(1,146,0),
        L(1,150,2), L(1,154,0), L(1,158,2), L(1,162,0), L(1,166,2), L(1,170,0), L(1,174,2), L(1,178,0),
        L(1,182,2), L(1,186,0), L(1,190,2), L(1,194,0), L(1,198,2), L(1,202,0), L(1,206,2), L(1,210,0),
        L(1,214,2), L(1,218,0), L(1,222,2), L(1,226,0), L(1,230,2), L(1,234,0), L(1,238,2), L(1,242,0),
        L(1,246,2),
        L(3,13,0), L(3,21,0), L(3,29,0), L(3,37,0), L(3,45,0), L(3,53,0), L(3,61,0), L(3,69,0),
        L(3,77,0), L(3,85,0), L(3,93,0), L(3,101,0), L(3,109,0), L(3,117,0), L(3,125,0), L(3,133,0),
        L(3,141,0), L(3,149,0), L(3,157,0), L(3,165,0), L(3,173,0), L(3,181,0), L(3,189,0), L(3,197,0),
        L(3,205,0), L(3,213,0), L(3,221,0), L(3,229,0), L(3,237,0), L(3,245,0)
    ]),

    // Level 6: SWING/MACRO - Giant Swings with obstacles throughout
    createLevel(6, [
        L(14,10,2), L(10,14,2), L(1,18,0), L(1,18,4), L(1,22,2), L(1,22,6), L(1,26,0), L(1,26,4),
        L(1,30,2), L(1,30,6), L(1,34,0), L(1,34,4), L(1,38,2), L(1,38,6), L(1,42,0), L(1,42,4),
        L(1,46,2), L(1,46,6), L(1,50,0), L(1,50,4), L(1,54,2), L(1,54,6), L(1,58,0), L(1,58,4),
        L(1,62,2), L(1,62,6), L(1,66,0), L(1,66,4), L(1,70,2), L(1,70,6), L(1,74,0), L(1,74,4),
        L(1,78,2), L(1,78,6), L(1,82,0), L(1,82,4), L(1,86,2), L(1,86,6), L(1,90,0), L(1,90,4),
        L(1,94,2), L(1,94,6), L(1,98,0), L(1,98,4), L(1,102,2), L(1,102,6), L(1,106,0), L(1,106,4),
        L(1,110,2), L(1,110,6), L(1,114,0), L(1,114,4), L(1,118,2), L(1,118,6), L(1,122,0), L(1,122,4),
        L(1,126,2), L(1,126,6), L(1,130,0), L(1,130,4), L(1,134,2), L(1,134,6), L(1,138,0), L(1,138,4),
        L(1,142,2), L(1,142,6), L(1,146,0), L(1,146,4), L(1,150,2), L(1,150,6), L(1,154,0), L(1,154,4),
        L(1,158,2), L(1,158,6), L(1,162,0), L(1,162,4), L(1,166,2), L(1,166,6), L(1,170,0), L(1,170,4),
        L(1,174,2), L(1,174,6), L(1,178,0), L(1,178,4), L(1,182,2), L(1,182,6), L(1,186,0), L(1,186,4),
        L(1,190,2), L(1,190,6), L(1,194,0), L(1,194,4), L(1,198,2), L(1,198,6), L(1,202,0), L(1,202,4),
        L(1,206,2), L(1,206,6), L(1,210,0), L(1,210,4), L(1,214,2), L(1,214,6), L(1,218,0), L(1,218,4),
        L(1,222,2), L(1,222,6), L(1,226,0), L(1,226,4), L(1,230,2), L(1,230,6), L(1,234,0), L(1,234,4),
        L(1,238,2), L(1,238,6), L(1,242,0), L(1,242,4), L(1,246,2), L(1,246,6),
        L(3,12,2), L(3,20,2), L(3,28,2), L(3,36,2), L(3,44,2), L(3,52,2), L(3,60,2), L(3,68,2),
        L(3,76,2), L(3,84,2), L(3,92,2), L(3,100,2), L(3,108,2), L(3,116,2), L(3,124,2), L(3,132,2),
        L(3,140,2), L(3,148,2), L(3,156,2), L(3,164,2), L(3,172,2), L(3,180,2), L(3,188,2), L(3,196,2),
        L(3,204,2), L(3,212,2), L(3,220,2), L(3,228,2), L(3,236,2), L(3,244,2)
    ]),

    // Level 7: LASER MAZE - Crazy new level with moving obstacles throughout
    createLevel(7, [
        L(1,10,0), L(1,14,0), L(1,18,0), L(1,22,0),
        L(20,26,2), L(20,30,4), L(20,34,2), L(20,38,4), // Moving platforms
        L(2,42,0), L(2,46,0), L(2,50,0), L(2,54,0),
        L(15,58,2), L(1,62,0), L(1,66,0), L(15,70,2),
        L(2,74,0), L(2,78,0), L(2,82,0), L(2,86,0),
        L(7,90,0), L(7,94,0), L(7,98,0), L(7,102,0), // Jump pads
        L(1,106,0), L(1,110,0), L(1,114,0), L(1,118,0),
        L(20,122,2), L(20,126,4), L(20,130,2), L(20,134,4), // More moving platforms
        L(2,138,0), L(2,142,0), L(2,146,0), L(2,150,0),
        L(15,154,2), L(1,158,0), L(1,162,0), L(15,166,2),
        L(2,170,0), L(2,174,0), L(2,178,0), L(2,182,0),
        L(7,186,0), L(7,190,0), L(7,194,0), L(7,198,0), // More jump pads
        L(1,202,0), L(1,206,0), L(1,210,0), L(1,214,0),
        L(20,218,2), L(20,222,4), L(20,226,2), L(20,230,4), // Even more moving platforms
        L(2,234,0), L(2,238,0), L(2,242,0), L(2,246,0),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 8: SPIRAL OF DOOM - Circular pattern with obstacles throughout
    createLevel(8, [
        L(1,10,0), L(1,15,1), L(1,20,2), L(1,25,3), L(1,30,4), L(1,35,5), L(1,40,6), L(1,45,7),
        L(1,50,6), L(1,55,5), L(1,60,4), L(1,65,3), L(1,70,2), L(1,75,1), L(1,80,0),
        L(1,85,1), L(1,90,2), L(1,95,3), L(1,100,4), L(1,105,5), L(1,110,6), L(1,115,7),
        L(1,120,6), L(1,125,5), L(1,130,4), L(1,135,3), L(1,140,2), L(1,145,1), L(1,150,0),
        L(1,155,1), L(1,160,2), L(1,165,3), L(1,170,4), L(1,175,5), L(1,180,6), L(1,185,7),
        L(1,190,6), L(1,195,5), L(1,200,4), L(1,205,3), L(1,210,2), L(1,215,1), L(1,220,0),
        L(1,225,1), L(1,230,2), L(1,235,3), L(1,240,4), L(1,245,5), L(1,250,6),
        L(2,25,0), L(2,35,0), L(2,45,0), L(2,55,0), L(2,65,0), L(2,75,0), L(2,85,0), L(2,95,0),
        L(2,105,0), L(2,115,0), L(2,125,0), L(2,135,0), L(2,145,0), L(2,155,0), L(2,165,0), L(2,175,0),
        L(2,185,0), L(2,195,0), L(2,205,0), L(2,215,0), L(2,225,0), L(2,235,0), L(2,245,0),
        L(3,12,0), L(3,22,1), L(3,32,2), L(3,42,3), L(3,52,4), L(3,62,5), L(3,72,6), L(3,82,7),
        L(3,92,6), L(3,102,5), L(3,112,4), L(3,122,3), L(3,132,2), L(3,142,1), L(3,152,0),
        L(3,162,1), L(3,172,2), L(3,182,3), L(3,192,4), L(3,202,5), L(3,212,6), L(3,222,7),
        L(3,232,6), L(3,242,5), L(3,252,4)
    ]),

    // Level 9: BOUNCE HOUSE - All jump pads with obstacles throughout
    createLevel(9, [
        L(7,10,0), L(7,14,0), L(7,18,0), L(7,22,0), L(7,26,0), L(7,30,0), L(7,34,0), L(7,38,0),
        L(7,42,0), L(7,46,0), L(7,50,0), L(7,54,0), L(7,58,0), L(7,62,0), L(7,66,0), L(7,70,0),
        L(7,74,0), L(7,78,0), L(7,82,0), L(7,86,0), L(7,90,0), L(7,94,0), L(7,98,0), L(7,102,0),
        L(7,106,0), L(7,110,0), L(7,114,0), L(7,118,0), L(7,122,0), L(7,126,0), L(7,130,0), L(7,134,0),
        L(7,138,0), L(7,142,0), L(7,146,0), L(7,150,0), L(7,154,0), L(7,158,0), L(7,162,0), L(7,166,0),
        L(7,170,0), L(7,174,0), L(7,178,0), L(7,182,0), L(7,186,0), L(7,190,0), L(7,194,0), L(7,198,0),
        L(7,202,0), L(7,206,0), L(7,210,0), L(7,214,0), L(7,218,0), L(7,222,0), L(7,226,0), L(7,230,0),
        L(7,234,0), L(7,238,0), L(7,242,0), L(7,246,0),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 10: DASH MANIA - Dash portals everywhere with obstacles throughout
    createLevel(10, [
        L(1,10,0), L(15,14,2), L(1,18,0), L(15,22,2), L(1,26,0), L(15,30,2), L(1,34,0), L(15,38,2),
        L(1,42,0), L(15,46,2), L(1,50,0), L(15,54,2), L(1,58,0), L(15,62,2), L(1,66,0), L(15,70,2),
        L(1,74,0), L(15,78,2), L(1,82,0), L(15,86,2), L(1,90,0), L(15,94,2), L(1,98,0), L(15,102,2),
        L(1,106,0), L(15,110,2), L(1,114,0), L(15,118,2), L(1,122,0), L(15,126,2), L(1,130,0), L(15,134,2),
        L(1,138,0), L(15,142,2), L(1,146,0), L(15,150,2), L(1,154,0), L(15,158,2), L(1,162,0), L(15,166,2),
        L(1,170,0), L(15,174,2), L(1,178,0), L(15,182,2), L(1,186,0), L(15,190,2), L(1,194,0), L(15,198,2),
        L(1,202,0), L(15,206,2), L(1,210,0), L(15,214,2), L(1,218,0), L(15,222,2), L(1,226,0), L(15,230,2),
        L(1,234,0), L(15,238,2), L(1,242,0), L(15,246,2),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 11: ZIGZAG EXTREME
    createLevel(11, [
        L(1,10,0), L(1,18,2), L(1,26,0), L(1,34,2), L(1,42,0), L(1,50,2), L(1,58,0), L(1,66,2),
        L(1,74,0), L(1,82,2), L(1,90,0), L(1,98,2), L(1,106,0), L(1,114,2), L(1,122,0), L(1,130,2),
        L(1,138,0), L(1,146,2), L(1,154,0), L(1,162,2), L(1,170,0), L(1,178,2), L(1,186,0), L(1,194,2),
        L(1,202,0), L(1,210,2), L(1,218,0), L(1,226,2), L(1,234,0), L(1,242,2), L(1,250,0),
        L(2,14,0), L(2,22,0), L(2,30,0), L(2,38,0), L(2,46,0), L(2,54,0), L(2,62,0), L(2,70,0),
        L(2,78,0), L(2,86,0), L(2,94,0), L(2,102,0), L(2,110,0), L(2,118,0), L(2,126,0), L(2,134,0),
        L(2,142,0), L(2,150,0), L(2,158,0), L(2,166,0), L(2,174,0), L(2,182,0), L(2,190,0), L(2,198,0),
        L(2,206,0), L(2,214,0), L(2,222,0), L(2,230,0), L(2,238,0), L(2,246,0),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 12: WALL JUMP MADNESS
    createLevel(12, [
        L(1,10,0), L(1,10,4), L(1,18,0), L(1,18,4), L(1,26,0), L(1,26,4), L(1,34,0), L(1,34,4),
        L(1,42,0), L(1,42,4), L(1,50,0), L(1,50,4), L(1,58,0), L(1,58,4), L(1,66,0), L(1,66,4),
        L(1,74,0), L(1,74,4), L(1,82,0), L(1,82,4), L(1,90,0), L(1,90,4), L(1,98,0), L(1,98,4),
        L(1,106,0), L(1,106,4), L(1,114,0), L(1,114,4), L(1,122,0), L(1,122,4), L(1,130,0), L(1,130,4),
        L(1,138,0), L(1,138,4), L(1,146,0), L(1,146,4), L(1,154,0), L(1,154,4), L(1,162,0), L(1,162,4),
        L(1,170,0), L(1,170,4), L(1,178,0), L(1,178,4), L(1,186,0), L(1,186,4), L(1,194,0), L(1,194,4),
        L(1,202,0), L(1,202,4), L(1,210,0), L(1,210,4), L(1,218,0), L(1,218,4), L(1,226,0), L(1,226,4),
        L(1,234,0), L(1,234,4), L(1,242,0), L(1,242,4), L(1,250,0), L(1,250,4),
        L(7,14,2), L(7,22,2), L(7,30,2), L(7,38,2), L(7,46,2), L(7,54,2), L(7,62,2), L(7,70,2),
        L(7,78,2), L(7,86,2), L(7,94,2), L(7,102,2), L(7,110,2), L(7,118,2), L(7,126,2), L(7,134,2),
        L(7,142,2), L(7,150,2), L(7,158,2), L(7,166,2), L(7,174,2), L(7,182,2), L(7,190,2), L(7,198,2),
        L(7,206,2), L(7,214,2), L(7,222,2), L(7,230,2), L(7,238,2), L(7,246,2),
        L(3,12,0), L(3,20,0), L(3,28,0), L(3,36,0), L(3,44,0), L(3,52,0), L(3,60,0), L(3,68,0),
        L(3,76,0), L(3,84,0), L(3,92,0), L(3,100,0), L(3,108,0), L(3,116,0), L(3,124,0), L(3,132,0),
        L(3,140,0), L(3,148,0), L(3,156,0), L(3,164,0), L(3,172,0), L(3,180,0), L(3,188,0), L(3,196,0),
        L(3,204,0), L(3,212,0), L(3,220,0), L(3,228,0), L(3,236,0), L(3,244,0)
    ]),

    // Level 13: SPIKE TUNNEL
    createLevel(13, [
        L(2,10,0), L(2,10,8), L(2,14,0), L(2,14,8), L(2,18,0), L(2,18,8), L(2,22,0), L(2,22,8),
        L(2,26,0), L(2,26,8), L(2,30,0), L(2,30,8), L(2,34,0), L(2,34,8), L(2,38,0), L(2,38,8),
        L(2,42,0), L(2,42,8), L(2,46,0), L(2,46,8), L(2,50,0), L(2,50,8), L(2,54,0), L(2,54,8),
        L(2,58,0), L(2,58,8), L(2,62,0), L(2,62,8), L(2,66,0), L(2,66,8), L(2,70,0), L(2,70,8),
        L(2,74,0), L(2,74,8), L(2,78,0), L(2,78,8), L(2,82,0), L(2,82,8), L(2,86,0), L(2,86,8),
        L(2,90,0), L(2,90,8), L(2,94,0), L(2,94,8), L(2,98,0), L(2,98,8), L(2,102,0), L(2,102,8),
        L(2,106,0), L(2,106,8), L(2,110,0), L(2,110,8), L(2,114,0), L(2,114,8), L(2,118,0), L(2,118,8),
        L(2,122,0), L(2,122,8), L(2,126,0), L(2,126,8), L(2,130,0), L(2,130,8), L(2,134,0), L(2,134,8),
        L(2,138,0), L(2,138,8), L(2,142,0), L(2,142,8), L(2,146,0), L(2,146,8), L(2,150,0), L(2,150,8),
        L(2,154,0), L(2,154,8), L(2,158,0), L(2,158,8), L(2,162,0), L(2,162,8), L(2,166,0), L(2,166,8),
        L(2,170,0), L(2,170,8), L(2,174,0), L(2,174,8), L(2,178,0), L(2,178,8), L(2,182,0), L(2,182,8),
        L(2,186,0), L(2,186,8), L(2,190,0), L(2,190,8), L(2,194,0), L(2,194,8), L(2,198,0), L(2,198,8),
        L(2,202,0), L(2,202,8), L(2,206,0), L(2,206,8), L(2,210,0), L(2,210,8), L(2,214,0), L(2,214,8),
        L(2,218,0), L(2,218,8), L(2,222,0), L(2,222,8), L(2,226,0), L(2,226,8), L(2,230,0), L(2,230,8),
        L(2,234,0), L(2,234,8), L(2,238,0), L(2,238,8), L(2,242,0), L(2,242,8), L(2,246,0), L(2,246,8),
        L(1,12,4), L(1,20,4), L(1,28,4), L(1,36,4), L(1,44,4), L(1,52,4), L(1,60,4), L(1,68,4),
        L(1,76,4), L(1,84,4), L(1,92,4), L(1,100,4), L(1,108,4), L(1,116,4), L(1,124,4), L(1,132,4),
        L(1,140,4), L(1,148,4), L(1,156,4), L(1,164,4), L(1,172,4), L(1,180,4), L(1,188,4), L(1,196,4),
        L(1,204,4), L(1,212,4), L(1,220,4), L(1,228,4), L(1,236,4), L(1,244,4),
        L(3,14,4), L(3,22,4), L(3,30,4), L(3,38,4), L(3,46,4), L(3,54,4), L(3,62,4), L(3,70,4),
        L(3,78,4), L(3,86,4), L(3,94,4), L(3,102,4), L(3,110,4), L(3,118,4), L(3,126,4), L(3,134,4),
        L(3,142,4), L(3,150,4), L(3,158,4), L(3,166,4), L(3,174,4), L(3,182,4), L(3,190,4), L(3,198,4),
        L(3,206,4), L(3,214,4), L(3,222,4), L(3,230,4), L(3,238,4), L(3,246,4)
    ]),

    // Level 14: BOUNCY CASTLE 2.0
    createLevel(14, [
        L(7,10,0), L(7,12,0), L(7,14,0), L(7,16,0), L(7,18,0), L(7,20,0), L(7,22,0), L(7,24,0),
        L(7,26,0), L(7,28,0), L(7,30,0), L(7,32,0), L(7,34,0), L(7,36,0), L(7,38,0), L(7,40,0),
        L(7,42,0), L(7,44,0), L(7,46,0), L(7,48,0), L(7,50,0), L(7,52,0), L(7,54,0), L(7,56,0),
        L(7,58,0), L(7,60,0), L(7,62,0), L(7,64,0), L(7,66,0), L(7,68,0), L(7,70,0), L(7,72,0),
        L(7,74,0), L(7,76,0), L(7,78,0), L(7,80,0), L(7,82,0), L(7,84,0), L(7,86,0), L(7,88,0),
        L(7,90,0), L(7,92,0), L(7,94,0), L(7,96,0), L(7,98,0), L(7,100,0), L(7,102,0), L(7,104,0),
        L(7,106,0), L(7,108,0), L(7,110,0), L(7,112,0), L(7,114,0), L(7,116,0), L(7,118,0), L(7,120,0),
        L(7,122,0), L(7,124,0), L(7,126,0), L(7,128,0), L(7,130,0), L(7,132,0), L(7,134,0), L(7,136,0),
        L(7,138,0), L(7,140,0), L(7,142,0), L(7,144,0), L(7,146,0), L(7,148,0), L(7,150,0), L(7,152,0),
        L(7,154,0), L(7,156,0), L(7,158,0), L(7,160,0), L(7,162,0), L(7,164,0), L(7,166,0), L(7,168,0),
        L(7,170,0), L(7,172,0), L(7,174,0), L(7,176,0), L(7,178,0), L(7,180,0), L(7,182,0), L(7,184,0),
        L(7,186,0), L(7,188,0), L(7,190,0), L(7,192,0), L(7,194,0), L(7,196,0), L(7,198,0), L(7,200,0),
        L(7,202,0), L(7,204,0), L(7,206,0), L(7,208,0), L(7,210,0), L(7,212,0), L(7,214,0), L(7,216,0),
        L(7,218,0), L(7,220,0), L(7,222,0), L(7,224,0), L(7,226,0), L(7,228,0), L(7,230,0), L(7,232,0),
        L(7,234,0), L(7,236,0), L(7,238,0), L(7,240,0), L(7,242,0), L(7,244,0), L(7,246,0), L(7,248,0),
        L(3,11,0), L(3,15,0), L(3,19,0), L(3,23,0), L(3,27,0), L(3,31,0), L(3,35,0), L(3,39,0),
        L(3,43,0), L(3,47,0), L(3,51,0), L(3,55,0), L(3,59,0), L(3,63,0), L(3,67,0), L(3,71,0),
        L(3,75,0), L(3,79,0), L(3,83,0), L(3,87,0), L(3,91,0), L(3,95,0), L(3,99,0), L(3,103,0),
        L(3,107,0), L(3,111,0), L(3,115,0), L(3,119,0), L(3,123,0), L(3,127,0), L(3,131,0), L(3,135,0),
        L(3,139,0), L(3,143,0), L(3,147,0), L(3,151,0), L(3,155,0), L(3,159,0), L(3,163,0), L(3,167,0),
        L(3,171,0), L(3,175,0), L(3,179,0), L(3,183,0), L(3,187,0), L(3,191,0), L(3,195,0), L(3,199,0),
        L(3,203,0), L(3,207,0), L(3,211,0), L(3,215,0), L(3,219,0), L(3,223,0), L(3,227,0), L(3,231,0),
        L(3,235,0), L(3,239,0), L(3,243,0), L(3,247,0)
    ]),

    // Level 15: DASH MASTER
    createLevel(15, [
        L(15,10,2), L(15,14,2), L(15,18,2), L(15,22,2), L(15,26,2), L(15,30,2), L(15,34,2), L(15,38,2),
        L(15,42,2), L(15,46,2), L(15,50,2), L(15,54,2), L(15,58,2), L(15,62,2), L(15,66,2), L(15,70,2),
        L(15,74,2), L(15,78,2), L(15,82,2), L(15,86,2), L(15,90,2), L(15,94,2), L(15,98,2), L(15,102,2),
        L(15,106,2), L(15,110,2), L(15,114,2), L(15,118,2), L(15,122,2), L(15,126,2), L(15,130,2), L(15,134,2),
        L(15,138,2), L(15,142,2), L(15,146,2), L(15,150,2), L(15,154,2), L(15,158,2), L(15,162,2), L(15,166,2),
        L(15,170,2), L(15,174,2), L(15,178,2), L(15,182,2), L(15,186,2), L(15,190,2), L(15,194,2), L(15,198,2),
        L(15,202,2), L(15,206,2), L(15,210,2), L(15,214,2), L(15,218,2), L(15,222,2), L(15,226,2), L(15,230,2),
        L(15,234,2), L(15,238,2), L(15,242,2), L(15,246,2),
        L(1,12,0), L(1,16,0), L(1,20,0), L(1,24,0), L(1,28,0), L(1,32,0), L(1,36,0), L(1,40,0),
        L(1,44,0), L(1,48,0), L(1,52,0), L(1,56,0), L(1,60,0), L(1,64,0), L(1,68,0), L(1,72,0),
        L(1,76,0), L(1,80,0), L(1,84,0), L(1,88,0), L(1,92,0), L(1,96,0), L(1,100,0), L(1,104,0),
        L(1,108,0), L(1,112,0), L(1,116,0), L(1,120,0), L(1,124,0), L(1,128,0), L(1,132,0), L(1,136,0),
        L(1,140,0), L(1,144,0), L(1,148,0), L(1,152,0), L(1,156,0), L(1,160,0), L(1,164,0), L(1,168,0),
        L(1,172,0), L(1,176,0), L(1,180,0), L(1,184,0), L(1,188,0), L(1,192,0), L(1,196,0), L(1,200,0),
        L(1,204,0), L(1,208,0), L(1,212,0), L(1,216,0), L(1,220,0), L(1,224,0), L(1,228,0), L(1,232,0),
        L(1,236,0), L(1,240,0), L(1,244,0), L(1,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ]),

    // Level 16: SLOW MOTION ZONE
    createLevel(16, [
        L(16,10,2), L(16,14,2), L(16,18,2), L(16,22,2), L(16,26,2), L(16,30,2), L(16,34,2), L(16,38,2),
        L(16,42,2), L(16,46,2), L(16,50,2), L(16,54,2), L(16,58,2), L(16,62,2), L(16,66,2), L(16,70,2),
        L(16,74,2), L(16,78,2), L(16,82,2), L(16,86,2), L(16,90,2), L(16,94,2), L(16,98,2), L(16,102,2),
        L(16,106,2), L(16,110,2), L(16,114,2), L(16,118,2), L(16,122,2), L(16,126,2), L(16,130,2), L(16,134,2),
        L(16,138,2), L(16,142,2), L(16,146,2), L(16,150,2), L(16,154,2), L(16,158,2), L(16,162,2), L(16,166,2),
        L(16,170,2), L(16,174,2), L(16,178,2), L(16,182,2), L(16,186,2), L(16,190,2), L(16,194,2), L(16,198,2),
        L(16,202,2), L(16,206,2), L(16,210,2), L(16,214,2), L(16,218,2), L(16,222,2), L(16,226,2), L(16,230,2),
        L(16,234,2), L(16,238,2), L(16,242,2), L(16,246,2),
        L(2,12,0), L(2,16,0), L(2,20,0), L(2,24,0), L(2,28,0), L(2,32,0), L(2,36,0), L(2,40,0),
        L(2,44,0), L(2,48,0), L(2,52,0), L(2,56,0), L(2,60,0), L(2,64,0), L(2,68,0), L(2,72,0),
        L(2,76,0), L(2,80,0), L(2,84,0), L(2,88,0), L(2,92,0), L(2,96,0), L(2,100,0), L(2,104,0),
        L(2,108,0), L(2,112,0), L(2,116,0), L(2,120,0), L(2,124,0), L(2,128,0), L(2,132,0), L(2,136,0),
        L(2,140,0), L(2,144,0), L(2,148,0), L(2,152,0), L(2,156,0), L(2,160,0), L(2,164,0), L(2,168,0),
        L(2,172,0), L(2,176,0), L(2,180,0), L(2,184,0), L(2,188,0), L(2,192,0), L(2,196,0), L(2,200,0),
        L(2,204,0), L(2,208,0), L(2,212,0), L(2,216,0), L(2,220,0), L(2,224,0), L(2,228,0), L(2,232,0),
        L(2,236,0), L(2,240,0), L(2,244,0), L(2,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ]),

    // Level 17: MINI GIANT
    createLevel(17, [
        L(9,10,2), L(10,14,2), L(9,18,2), L(10,22,2), L(9,26,2), L(10,30,2), L(9,34,2), L(10,38,2),
        L(9,42,2), L(10,46,2), L(9,50,2), L(10,54,2), L(9,58,2), L(10,62,2), L(9,66,2), L(10,70,2),
        L(9,74,2), L(10,78,2), L(9,82,2), L(10,86,2), L(9,90,2), L(10,94,2), L(9,98,2), L(10,102,2),
        L(9,106,2), L(10,110,2), L(9,114,2), L(10,118,2), L(9,122,2), L(10,126,2), L(9,130,2), L(10,134,2),
        L(9,138,2), L(10,142,2), L(9,146,2), L(10,150,2), L(9,154,2), L(10,158,2), L(9,162,2), L(10,166,2),
        L(9,170,2), L(10,174,2), L(9,178,2), L(10,182,2), L(9,186,2), L(10,190,2), L(9,194,2), L(10,198,2),
        L(9,202,2), L(10,206,2), L(9,210,2), L(10,214,2), L(9,218,2), L(10,222,2), L(9,226,2), L(10,230,2),
        L(9,234,2), L(10,238,2), L(9,242,2), L(10,246,2),
        L(1,12,0), L(1,16,0), L(1,20,0), L(1,24,0), L(1,28,0), L(1,32,0), L(1,36,0), L(1,40,0),
        L(1,44,0), L(1,48,0), L(1,52,0), L(1,56,0), L(1,60,0), L(1,64,0), L(1,68,0), L(1,72,0),
        L(1,76,0), L(1,80,0), L(1,84,0), L(1,88,0), L(1,92,0), L(1,96,0), L(1,100,0), L(1,104,0),
        L(1,108,0), L(1,112,0), L(1,116,0), L(1,120,0), L(1,124,0), L(1,128,0), L(1,132,0), L(1,136,0),
        L(1,140,0), L(1,144,0), L(1,148,0), L(1,152,0), L(1,156,0), L(1,160,0), L(1,164,0), L(1,168,0),
        L(1,172,0), L(1,176,0), L(1,180,0), L(1,184,0), L(1,188,0), L(1,192,0), L(1,196,0), L(1,200,0),
        L(1,204,0), L(1,208,0), L(1,212,0), L(1,216,0), L(1,220,0), L(1,224,0), L(1,228,0), L(1,232,0),
        L(1,236,0), L(1,240,0), L(1,244,0), L(1,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ]),

    // Level 18: PORTAL PARTY
    createLevel(18, [
        L(4,10,2), L(5,14,2), L(6,18,2), L(11,22,2), L(12,26,2), L(14,30,2), L(4,34,2), L(5,38,2),
        L(6,42,2), L(11,46,2), L(12,50,2), L(14,54,2), L(4,58,2), L(5,62,2), L(6,66,2), L(11,70,2),
        L(12,74,2), L(14,78,2), L(4,82,2), L(5,86,2), L(6,90,2), L(11,94,2), L(12,98,2), L(14,102,2),
        L(4,106,2), L(5,110,2), L(6,114,2), L(11,118,2), L(12,122,2), L(14,126,2), L(4,130,2), L(5,134,2),
        L(6,138,2), L(11,142,2), L(12,146,2), L(14,150,2), L(4,154,2), L(5,158,2), L(6,162,2), L(11,166,2),
        L(12,170,2), L(14,174,2), L(4,178,2), L(5,182,2), L(6,186,2), L(11,190,2), L(12,194,2), L(14,198,2),
        L(4,202,2), L(5,206,2), L(6,210,2), L(11,214,2), L(12,218,2), L(14,222,2), L(4,226,2), L(5,230,2),
        L(6,234,2), L(11,238,2), L(12,242,2), L(14,246,2),
        L(1,12,0), L(1,16,0), L(1,20,0), L(1,24,0), L(1,28,0), L(1,32,0), L(1,36,0), L(1,40,0),
        L(1,44,0), L(1,48,0), L(1,52,0), L(1,56,0), L(1,60,0), L(1,64,0), L(1,68,0), L(1,72,0),
        L(1,76,0), L(1,80,0), L(1,84,0), L(1,88,0), L(1,92,0), L(1,96,0), L(1,100,0), L(1,104,0),
        L(1,108,0), L(1,112,0), L(1,116,0), L(1,120,0), L(1,124,0), L(1,128,0), L(1,132,0), L(1,136,0),
        L(1,140,0), L(1,144,0), L(1,148,0), L(1,152,0), L(1,156,0), L(1,160,0), L(1,164,0), L(1,168,0),
        L(1,172,0), L(1,176,0), L(1,180,0), L(1,184,0), L(1,188,0), L(1,192,0), L(1,196,0), L(1,200,0),
        L(1,204,0), L(1,208,0), L(1,212,0), L(1,216,0), L(1,220,0), L(1,224,0), L(1,228,0), L(1,232,0),
        L(1,236,0), L(1,240,0), L(1,244,0), L(1,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ]),

    // Level 19: MOVING PLATFORM MAYHEM
    createLevel(19, [
        L(20,10,2), L(20,14,4), L(20,18,2), L(20,22,4), L(20,26,2), L(20,30,4), L(20,34,2), L(20,38,4),
        L(20,42,2), L(20,46,4), L(20,50,2), L(20,54,4), L(20,58,2), L(20,62,4), L(20,66,2), L(20,70,4),
        L(20,74,2), L(20,78,4), L(20,82,2), L(20,86,4), L(20,90,2), L(20,94,4), L(20,98,2), L(20,102,4),
        L(20,106,2), L(20,110,4), L(20,114,2), L(20,118,4), L(20,122,2), L(20,126,4), L(20,130,2), L(20,134,4),
        L(20,138,2), L(20,142,4), L(20,146,2), L(20,150,4), L(20,154,2), L(20,158,4), L(20,162,2), L(20,166,4),
        L(20,170,2), L(20,174,4), L(20,178,2), L(20,182,4), L(20,186,2), L(20,190,4), L(20,194,2), L(20,198,4),
        L(20,202,2), L(20,206,4), L(20,210,2), L(20,214,4), L(20,218,2), L(20,222,4), L(20,226,2), L(20,230,4),
        L(20,234,2), L(20,238,4), L(20,242,2), L(20,246,4),
        L(1,12,0), L(1,16,0), L(1,20,0), L(1,24,0), L(1,28,0), L(1,32,0), L(1,36,0), L(1,40,0),
        L(1,44,0), L(1,48,0), L(1,52,0), L(1,56,0), L(1,60,0), L(1,64,0), L(1,68,0), L(1,72,0),
        L(1,76,0), L(1,80,0), L(1,84,0), L(1,88,0), L(1,92,0), L(1,96,0), L(1,100,0), L(1,104,0),
        L(1,108,0), L(1,112,0), L(1,116,0), L(1,120,0), L(1,124,0), L(1,128,0), L(1,132,0), L(1,136,0),
        L(1,140,0), L(1,144,0), L(1,148,0), L(1,152,0), L(1,156,0), L(1,160,0), L(1,164,0), L(1,168,0),
        L(1,172,0), L(1,176,0), L(1,180,0), L(1,184,0), L(1,188,0), L(1,192,0), L(1,196,0), L(1,200,0),
        L(1,204,0), L(1,208,0), L(1,212,0), L(1,216,0), L(1,220,0), L(1,224,0), L(1,228,0), L(1,232,0),
        L(1,236,0), L(1,240,0), L(1,244,0), L(1,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ]),

    // Level 20: CHECKPOINT RACE
    createLevel(20, [
        L(13,10,2), L(13,20,2), L(13,30,2), L(13,40,2), L(13,50,2), L(13,60,2), L(13,70,2), L(13,80,2),
        L(13,90,2), L(13,100,2), L(13,110,2), L(13,120,2), L(13,130,2), L(13,140,2), L(13,150,2), L(13,160,2),
        L(13,170,2), L(13,180,2), L(13,190,2), L(13,200,2), L(13,210,2), L(13,220,2), L(13,230,2), L(13,240,2),
        L(1,12,0), L(1,16,0), L(1,20,0), L(1,24,0), L(1,28,0), L(1,32,0), L(1,36,0), L(1,40,0),
        L(1,44,0), L(1,48,0), L(1,52,0), L(1,56,0), L(1,60,0), L(1,64,0), L(1,68,0), L(1,72,0),
        L(1,76,0), L(1,80,0), L(1,84,0), L(1,88,0), L(1,92,0), L(1,96,0), L(1,100,0), L(1,104,0),
        L(1,108,0), L(1,112,0), L(1,116,0), L(1,120,0), L(1,124,0), L(1,128,0), L(1,132,0), L(1,136,0),
        L(1,140,0), L(1,144,0), L(1,148,0), L(1,152,0), L(1,156,0), L(1,160,0), L(1,164,0), L(1,168,0),
        L(1,172,0), L(1,176,0), L(1,180,0), L(1,184,0), L(1,188,0), L(1,192,0), L(1,196,0), L(1,200,0),
        L(1,204,0), L(1,208,0), L(1,212,0), L(1,216,0), L(1,220,0), L(1,224,0), L(1,228,0), L(1,232,0),
        L(1,236,0), L(1,240,0), L(1,244,0), L(1,248,0),
        L(3,13,0), L(3,17,0), L(3,21,0), L(3,25,0), L(3,29,0), L(3,33,0), L(3,37,0), L(3,41,0),
        L(3,45,0), L(3,49,0), L(3,53,0), L(3,57,0), L(3,61,0), L(3,65,0), L(3,69,0), L(3,73,0),
        L(3,77,0), L(3,81,0), L(3,85,0), L(3,89,0), L(3,93,0), L(3,97,0), L(3,101,0), L(3,105,0),
        L(3,109,0), L(3,113,0), L(3,117,0), L(3,121,0), L(3,125,0), L(3,129,0), L(3,133,0), L(3,137,0),
        L(3,141,0), L(3,145,0), L(3,149,0), L(3,153,0), L(3,157,0), L(3,161,0), L(3,165,0), L(3,169,0),
        L(3,173,0), L(3,177,0), L(3,181,0), L(3,185,0), L(3,189,0), L(3,193,0), L(3,197,0), L(3,201,0),
        L(3,205,0), L(3,209,0), L(3,213,0), L(3,217,0), L(3,221,0), L(3,225,0), L(3,229,0), L(3,233,0),
        L(3,237,0), L(3,241,0), L(3,245,0), L(3,249,0)
    ])
];

// Generate remaining 30 completely unique levels (21-50)
for (let i = 21; i <= 50; i++) {
    const levelObjects = [];
    
    // Each level gets completely unique design
    switch(i) {
        case 21: // WAVE DASH
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(11, x, 2));
                levelObjects.push(L(15, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 22: // UFO PRECISION
            for(let x = 10; x <= 250; x += 8) {
                levelObjects.push(L(5, x, 2));
                levelObjects.push(L(2, x+4, 0));
                levelObjects.push(L(2, x+4, 8));
                if(x % 16 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 23: // ROBOT MINI JUMP
            for(let x = 10; x <= 250; x += 6) {
                levelObjects.push(L(12, x, 0));
                levelObjects.push(L(9, x+3, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 12 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 24: // SWING MACRO
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(14, x, 2));
                levelObjects.push(L(10, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 25: // GRAVITY SHIFT
            for(let x = 10; x <= 250; x += 12) {
                levelObjects.push(L(16, x, 2));
                levelObjects.push(L(1, x+6, 0));
                levelObjects.push(L(2, x+3, 0));
                if(x % 24 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 26: // LASER GRID
            for(let x = 10; x <= 250; x += 5) {
                levelObjects.push(L(2, x, 0));
                levelObjects.push(L(2, x, 8));
                if(x % 10 === 0) levelObjects.push(L(1, x, 4));
                if(x % 15 === 0) levelObjects.push(L(3, x, 4));
            }
            break;
            
        case 27: // BOUNCE MAZE
            for(let x = 10; x <= 250; x += 4) {
                levelObjects.push(L(7, x, 0));
                if(x % 8 === 0) levelObjects.push(L(2, x, 0));
                if(x % 12 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 28: // DASH RACE
            for(let x = 10; x <= 250; x += 8) {
                levelObjects.push(L(15, x, 2));
                levelObjects.push(L(1, x+4, 0));
                levelObjects.push(L(2, x+2, 0));
                if(x % 16 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 29: // SLOW MOTION DASH
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(16, x, 2));
                levelObjects.push(L(15, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 30: // MINI WAVE
            for(let x = 10; x <= 250; x += 8) {
                levelObjects.push(L(11, x, 2));
                levelObjects.push(L(9, x+4, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 16 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 31: // UFO WAVE
            for(let x = 10; x <= 250; x += 9) {
                levelObjects.push(L(5, x, 2));
                levelObjects.push(L(11, x+4, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 18 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 32: // ROBOT DASH
            for(let x = 10; x <= 250; x += 7) {
                levelObjects.push(L(12, x, 0));
                levelObjects.push(L(15, x+3, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 14 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 33: // SWING WAVE
            for(let x = 10; x <= 250; x += 11) {
                levelObjects.push(L(14, x, 2));
                levelObjects.push(L(11, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 22 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 34: // GRAVITY DASH
            for(let x = 10; x <= 250; x += 13) {
                levelObjects.push(L(16, x, 2));
                levelObjects.push(L(15, x+6, 2));
                levelObjects.push(L(1, x+3, 0));
                if(x % 26 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 35: // LASER DASH
            for(let x = 10; x <= 250; x += 6) {
                levelObjects.push(L(2, x, 0));
                levelObjects.push(L(15, x+3, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 12 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 36: // BOUNCE DASH
            for(let x = 10; x <= 250; x += 5) {
                levelObjects.push(L(7, x, 0));
                levelObjects.push(L(15, x+2, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 10 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 37: // MINI SLOW
            for(let x = 10; x <= 250; x += 9) {
                levelObjects.push(L(9, x, 2));
                levelObjects.push(L(16, x+4, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 18 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 38: // UFO SLOW
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(5, x, 2));
                levelObjects.push(L(16, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 39: // ROBOT SLOW
            for(let x = 10; x <= 250; x += 8) {
                levelObjects.push(L(12, x, 0));
                levelObjects.push(L(16, x+4, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 16 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 40: // SWING SLOW
            for(let x = 10; x <= 250; x += 12) {
                levelObjects.push(L(14, x, 2));
                levelObjects.push(L(16, x+6, 2));
                levelObjects.push(L(1, x+3, 0));
                if(x % 24 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 41: // GRAVITY WAVE
            for(let x = 10; x <= 250; x += 11) {
                levelObjects.push(L(16, x, 2));
                levelObjects.push(L(11, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 22 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 42: // LASER WAVE
            for(let x = 10; x <= 250; x += 7) {
                levelObjects.push(L(2, x, 0));
                levelObjects.push(L(11, x+3, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 14 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 43: // BOUNCE WAVE
            for(let x = 10; x <= 250; x += 6) {
                levelObjects.push(L(7, x, 0));
                levelObjects.push(L(11, x+3, 2));
                levelObjects.push(L(1, x+1, 0));
                if(x % 12 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 44: // MINI UFO
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(9, x, 2));
                levelObjects.push(L(5, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 45: // UFO ROBOT
            for(let x = 10; x <= 250; x += 9) {
                levelObjects.push(L(5, x, 2));
                levelObjects.push(L(12, x+4, 0));
                levelObjects.push(L(1, x+2, 0));
                if(x % 18 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 46: // ROBOT SWING
            for(let x = 10; x <= 250; x += 11) {
                levelObjects.push(L(12, x, 0));
                levelObjects.push(L(14, x+5, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 22 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 47: // SWING UFO
            for(let x = 10; x <= 250; x += 12) {
                levelObjects.push(L(14, x, 2));
                levelObjects.push(L(5, x+6, 2));
                levelObjects.push(L(1, x+3, 0));
                if(x % 24 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 48: // GRAVITY ROBOT
            for(let x = 10; x <= 250; x += 10) {
                levelObjects.push(L(16, x, 2));
                levelObjects.push(L(12, x+5, 0));
                levelObjects.push(L(1, x+2, 0));
                if(x % 20 === 0) levelObjects.push(L(3, x, 2));
            }
            break;
            
        case 49: // LASER UFO
            for(let x = 10; x <= 250; x += 8) {
                levelObjects.push(L(2, x, 0));
                levelObjects.push(L(5, x+4, 2));
                levelObjects.push(L(1, x+2, 0));
                if(x % 16 === 0) levelObjects.push(L(3, x, 0));
            }
            break;
            
        case 50: // ULTIMATE CHALLENGE
            const types = [1,2,7,9,10,11,12,14,15,16,20];
            for(let x = 10; x <= 250; x += 7) {
                const type = types[Math.floor(Math.random() * types.length)];
                levelObjects.push(L(type, x, Math.random() * 6));
                if(x % 14 === 0) levelObjects.push(L(3, x, Math.random() * 6));
            }
            break;
    }
    
    LEVELS[i] = createLevel(i, levelObjects);
}

// --- ENGINE ---
const Game = {
    canvas: document.getElementById('gameCanvas'),
    ctx: document.getElementById('gameCanvas').getContext('2d'),
    state: 'menu', 
    level: [], 
    att: 1, 
    camX: 0, 
    floorY: 0,
    shake: 0,
    currLvlIdx: 0,
    pauseBtn: document.getElementById('pause-main-btn'),
    bgHue: 200, 
    bgSat: 100,  
    isMobile: window.innerWidth <= 768, 
    goalX: 100000, 
    startPos: { x: CFG.START_X * CFG.tile, y: 0, g: CFG.g, mode: 'cube', scale: CFG.MACRO_SCALE },
    currentCheckpoint: null,
    timeScale: 1.0, 
    dashActive: false,
    slowTimer: null, 

    init: function() {
        this.resize();
        window.onresize = ()=>this.resize();
        document.getElementById('unlock-count').innerText = unlocked;
        document.getElementById('unlock-count').parentElement.innerHTML = `Levels unlocked: <span id="unlock-count">${unlocked}</span>/${CFG.TOTAL_LEVELS}`;
        Player.loadColors();
        this.updateCoinDisplay();
        AUDIO.init();
        this.checkMobileControls();
        this.loop();
        
        document.getElementById('shop-back-btn').onclick = UI.home;
        document.querySelector('#menu-pause button.pink').onclick = UI.home;
        
        // Initialize level editor
        LevelEditor.init();
    },

    updateCoinDisplay: function() {
        document.getElementById('coin-count-val').innerText = totalCoins;
        if(document.getElementById('menu-coins')) document.getElementById('menu-coins').innerText = totalCoins;
        if(document.getElementById('shop-coins')) document.getElementById('shop-coins').innerText = totalCoins;
        localStorage.setItem('nd_coins', totalCoins);
    },

    resize: function() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        this.floorY = this.canvas.height - 150;
        this.isMobile = window.innerWidth <= 768;
        this.checkMobileControls();
    },

    checkMobileControls: function() {
        if (this.isMobile && this.state === 'game') {
            document.getElementById('game-container').classList.add('show-mobile');
        } else {
            document.getElementById('game-container').classList.remove('show-mobile');
        }
    },

    loadLevel: function(idx) {
        if(idx < 0 || idx >= LEVELS.length) return;
        this.currLvlIdx = idx;
        
        const themeIdx = idx % THEMES.length; 
        const theme = THEMES[themeIdx];
        this.bgHue = theme[1];
        this.bgSat = theme[2];
        
        this.level = JSON.parse(JSON.stringify(LEVELS[idx])); 
        this.currentCheckpoint = null;
        this.startPos = { x: CFG.START_X * CFG.tile, y: 0, g: CFG.g, mode: 'cube', scale: CFG.MACRO_SCALE };
        this.timeScale = 1.0;
        this.clearSlowTimer(); 
        this.start(theme[0]); 
    },

    start: function(bgmFreq) {
        this.state = 'game';
        Player.reset();
        this.camX = 0;
        this.att = 1; 
        document.getElementById('att').innerText = this.att;
        UI.hide();
        document.getElementById('hud').style.display = 'block';
        AUDIO.startBGM(bgmFreq);
        this.checkMobileControls(); 
        
        const goalObject = this.level.find(o => o.t === 99);
        this.goalX = goalObject ? goalObject.x * CFG.tile : 100000;

        if(this.currLvlIdx === 0 && !tutorialDone) { 
            this.showTutorialMessage("Hold JUMP for continuous jumps!", 5000);
            tutorialDone = true;
            localStorage.setItem('nd_tutorial_done', 'true');
        }
    },

    showTutorialMessage: function(message, duration) {
        const msgEl = document.getElementById('tutorial-msg');
        msgEl.innerText = message;
        msgEl.style.display = 'block';
        if (duration) {
            setTimeout(() => {
                if(msgEl.innerText === message) msgEl.style.display = 'none';
            }, duration);
        }
    },

    retry: function(e) { 
        if(e) e.preventDefault(); 
        if (this.state === 'game' || this.state === 'dead' || this.state === 'win') {
            this.state = 'game';
            
            Player.reset(this.currentCheckpoint); 

            this.att++;
            document.getElementById('att').innerText = this.att;
            UI.hide();
            document.getElementById('tutorial-msg').style.display = 'none';
            this.checkMobileControls(); 
            this.timeScale = 1.0;
            Game.dashActive = false;
            this.clearSlowTimer();
            
            if(!this.currentCheckpoint) {
                this.level = JSON.parse(JSON.stringify(LEVELS[this.currLvlIdx]));
            } else {
                this.level = this.currentCheckpoint.levelState;
            }
            
            const goalObject = this.level.find(o => o.t === 99);
            this.goalX = goalObject ? goalObject.x * CFG.tile : 100000;
        }
    },

    setCheckpoint: function(x, y, g, mode, scale) {
        this.currentCheckpoint = {
            x: x, 
            y: y, 
            g: g, 
            mode: mode, 
            scale: scale,
            levelState: JSON.parse(JSON.stringify(this.level)) 
        };
        AUDIO.checkpoint();
        this.showTutorialMessage("Checkpoint Saved!", 2000);
    },

    win: function() {
        if (this.state === 'game') {
            this.state = 'win';
            AUDIO.win();
            AUDIO.stopBGM();
            this.clearSlowTimer();
            
            if (this.currLvlIdx + 2 > unlocked) {
                unlocked = this.currLvlIdx + 2;
                localStorage.setItem('nd_level', unlocked);
                document.getElementById('unlock-count').innerText = unlocked;
            }
            
            document.getElementById('pause-title').innerText = `LEVEL ${this.currLvlIdx + 1} COMPLETE!`;
            document.getElementById('pause-p').innerText = `Attempts: ${this.att}`;
            
            this.pauseBtn.innerText = `NEXT LEVEL ${this.currLvlIdx + 2}`;
            this.pauseBtn.classList.add('next');
            this.pauseBtn.onclick = () => {
                if (this.currLvlIdx + 1 < LEVELS.length) {
                    Game.loadLevel(this.currLvlIdx + 1);
                } else {
                    alert('Congratulations! You beat all current levels!');
                    UI.home();
                }
            };

            UI.show('menu-pause');
        }
    },

    crash: function() {
        if (this.state === 'game' || this.state === 'dash') {
            this.state = 'dead';
            this.shake = 10;
            this.timeScale = 1.0;
            Game.dashActive = false;
            this.clearSlowTimer();
            
            AUDIO.die();
            AUDIO.stopBGM();
            
            let percentage = Math.floor(((Player.x - (this.currentCheckpoint ? this.currentCheckpoint.x : CFG.START_X * CFG.tile)) / (this.goalX - (this.currentCheckpoint ? this.currentCheckpoint.x : CFG.START_X * CFG.tile))) * 100);
            percentage = Math.max(0, Math.min(100, percentage));
            
            document.getElementById('pause-title').innerText = 'CRASHED!';
            document.getElementById('pause-p').innerText = `${percentage}%`;
            this.pauseBtn.innerText = 'RETRY (R Key)';
            this.pauseBtn.classList.remove('next');
            this.pauseBtn.onclick = () => Game.retry();
            
            UI.show('menu-pause');
        }
    },
    
    applySlow: function() {
        if (this.slowTimer) {
            clearTimeout(this.slowTimer);
        }
        Game.timeScale = CFG.SLOW_FACTOR;
        Player.dx = CFG.spd * Game.timeScale;
        AUDIO.slow();
        Game.showTutorialMessage("SLOW MOTION!", 1500);

        this.slowTimer = setTimeout(() => {
            Game.timeScale = 1.0;
            Player.dx = CFG.spd * Game.timeScale;
            this.slowTimer = null;
        }, CFG.SLOW_DURATION);
    },

    clearSlowTimer: function() {
        if (this.slowTimer) {
            clearTimeout(this.slowTimer);
            this.slowTimer = null;
        }
        this.timeScale = 1.0;
    },

    loop: function() {
        let ctx = this.ctx;
        
        let hue = this.bgHue;
        if (this.bgSat > 30) hue = (this.bgHue + (Player.x / 20) % 360) % 360; 
        
        // Flashy background with gradient
        const gradient = ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
        gradient.addColorStop(0, `hsl(${hue}, ${this.bgSat}%, 5%)`);
        gradient.addColorStop(1, `hsl(${(hue + 60) % 360}, ${this.bgSat}%, 8%)`);
        ctx.fillStyle = gradient;
        ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
        
        ctx.save();
        if(this.shake>0) {
            ctx.translate((Math.random()-.5)*this.shake, (Math.random()-.5)*this.shake);
            this.shake*=0.9;
        }
        
        if(Player.g < 0) {
            ctx.scale(1, -1);
            ctx.translate(0, -this.canvas.height); 
        }

        if(this.state === 'game') {
            Player.update();
            this.camX = Player.x - 300;
        } 

        let targetY = Player.y * 0.6;
        let camY = (this.canvas.height - 150) - targetY; 
        
        // Flashy grid lines
        ctx.strokeStyle = `hsla(${hue}, 80%, 70%, 0.2)`;
        ctx.lineWidth = 3;
        ctx.shadowBlur = 10;
        ctx.shadowColor = `hsl(${hue}, 80%, 70%)`;
        let ox = -(this.camX % CFG.tile);
        for(let i=ox; i<this.canvas.width; i+=CFG.tile) {
            ctx.beginPath(); 
            ctx.moveTo(i,0); 
            ctx.lineTo(i, this.canvas.height); 
            ctx.stroke();
        }
        ctx.shadowBlur = 0;
        
        // Floor with neon effect
        ctx.fillStyle = Player.mainColor;
        ctx.shadowBlur = 20;
        ctx.shadowColor = Player.mainColor;
        ctx.fillRect(0, camY, this.canvas.width, 4); 
        ctx.shadowBlur = 0;
        ctx.fillStyle = '#111';
        ctx.fillRect(0, camY+4, this.canvas.width, 500);

        // 8-block height limit death zone for ALL modes
        const deathZoneTop = camY - CFG.FLYING_SPIKE_ZONE;
        const deathZoneBottom = camY + 4 + CFG.FLYING_SPIKE_ZONE;
        
        // Draw death zone boundaries
        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
        ctx.fillRect(0, deathZoneTop, this.canvas.width, 10);
        ctx.fillRect(0, deathZoneBottom, this.canvas.width, 10);
        
        ctx.strokeStyle = '#ff0000';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(0, deathZoneTop);
        ctx.lineTo(this.canvas.width, deathZoneTop);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, deathZoneBottom);
        ctx.lineTo(this.canvas.width, deathZoneBottom);
        ctx.stroke();

        this.level.forEach(o => {
            let dx = o.x * CFG.tile - this.camX;
            let oy = -(o.y * CFG.tile); 
            let dy = camY + oy - CFG.tile; 

            if(dx < -CFG.tile || dx > this.canvas.width) return;

            if(o.t===1) { 
                ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                ctx.shadowBlur = 15;
                ctx.shadowColor = `hsl(${hue}, 80%, 60%)`;
                ctx.fillRect(dx,dy,CFG.tile,CFG.tile); 
                ctx.shadowBlur = 0;
                ctx.strokeStyle='rgba(255,255,255,0.9)'; 
                ctx.lineWidth=4; 
                ctx.strokeRect(dx,dy,CFG.tile,CFG.tile); 
                ctx.fillStyle='rgba(0,0,0,0.5)'; 
                ctx.fillRect(dx+5,dy+5,CFG.tile-10,CFG.tile-10); 
            } 
            else if (o.t===2) { 
                ctx.fillStyle='#ff3333'; 
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ff3333';
                ctx.beginPath(); 
                if (o.y === 8) {
                    ctx.moveTo(dx+10, dy); 
                    ctx.lineTo(dx+25, dy+45); 
                    ctx.lineTo(dx+40, dy); 
                } else {
                    ctx.moveTo(dx+10, dy+CFG.tile); 
                    ctx.lineTo(dx+25, dy+5); 
                    ctx.lineTo(dx+40, dy+CFG.tile); 
                }
                ctx.fill(); 
                ctx.shadowBlur = 0;
                ctx.strokeStyle='#fff'; 
                ctx.lineWidth=2; 
                ctx.stroke(); 
            }
            else if (o.t===3) { 
                ctx.fillStyle='#ffff00'; 
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#ffff00';
                ctx.beginPath(); 
                ctx.arc(dx+25,dy+25,12,0,7); 
                ctx.fill(); 
                ctx.shadowBlur = 0;
                ctx.strokeStyle='#ff00ff'; 
                ctx.lineWidth=4; 
                ctx.beginPath(); 
                ctx.arc(dx+25,dy+25,20,0,7); 
                ctx.stroke(); 
            }
            else if (o.t===7) { 
                ctx.fillStyle='#00ffff'; 
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#00ffff';
                ctx.fillRect(dx+5, dy+40, 40, 10); 
                ctx.shadowBlur = 0;
                ctx.strokeStyle='#fff'; 
                ctx.lineWidth=4; 
                ctx.strokeRect(dx+5, dy+40, 40, 10); 
            }
            else if (o.t===20) { 
                ctx.fillStyle='#ff8800'; 
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ff8800';
                ctx.fillRect(dx, dy, CFG.tile, 15); 
                ctx.shadowBlur = 0;
                ctx.strokeStyle='#fff'; 
                ctx.lineWidth=2; 
                ctx.strokeRect(dx, dy, CFG.tile, 15); 
            }
            // Portal types with flashy effects
            else if ([4,5,6,11,12,14,15,16,9,10].includes(o.t)) {
                const portalColors = {
                    4: '#00ff00', 5: '#ffaa00', 6: '#ffffff', 11: '#ff0000',
                    12: '#00ff88', 14: '#ff00ff', 15: '#ff0000', 16: '#00ff00',
                    9: '#ff8800', 10: '#0088ff'
                };
                ctx.strokeStyle = portalColors[o.t];
                ctx.lineWidth = 6;
                ctx.shadowBlur = 20;
                ctx.shadowColor = portalColors[o.t];
                ctx.strokeRect(dx,dy,40,CFG.GRAVITY_BLOCK_HEIGHT);
                ctx.shadowBlur = 0;
            }
            else if (o.t===13) { 
                ctx.fillStyle='rgba(0, 255, 0, 0.3)'; 
                ctx.fillRect(dx, -500, 10, 2000); 
                ctx.strokeStyle='rgba(0, 255, 0, 0.8)'; 
                ctx.lineWidth=6; 
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#00ff00';
                ctx.beginPath(); 
                ctx.moveTo(dx, dy+CFG.tile-5); 
                ctx.lineTo(dx + 10, dy+CFG.tile-5); 
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
            else if (o.t===99) { 
                ctx.fillStyle='#00ff00'; 
                ctx.globalAlpha=0.4; 
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#00ff00';
                ctx.fillRect(dx, -500, 100, 2000); 
                ctx.globalAlpha=1;
                ctx.shadowBlur = 0;
            }
        });

        if(this.state !== 'dead') Player.draw(ctx, camY);

        if(this.state === 'game') {
            let endX = this.goalX;
            let startX = this.currentCheckpoint ? this.currentCheckpoint.x : CFG.START_X * CFG.tile;
            
            let p = Math.max(0, Math.min(100, ((Player.x - startX) / (endX - startX)) * 100));
            document.getElementById('prog').style.width = p+'%';
            document.getElementById('progress-percent').innerText = Math.round(p) + '%';
        }

        ctx.restore();
        requestAnimationFrame(()=>this.loop());
    }
};

// --- PLAYER PHYSICS ---
const Player = {
    x:0, y:0, w:40, h:40, 
    dx: CFG.spd, dy:0, 
    mode:'cube', angle:0, onGround:false,
    g: CFG.g,
    scale: CFG.MACRO_SCALE, 
    mainColor: '#00ffff',
    secondaryColor: '#ff0088',
    waveAngle: 0, 
    isSwinging: false, 
    swingBlock: null,
    lastJumpTime: 0,
    dashTargetX: 0,

    loadColors: function() {
        const skin = SKINS[equippedSkinIndex];
        this.mainColor = skin.main;
        this.secondaryColor = skin.secondary;
        document.documentElement.style.setProperty('--player-main', this.mainColor);
        document.documentElement.style.setProperty('--player-sec', this.secondaryColor);
    },

    equipSkin: function(index) {
        equippedSkinIndex = index;
        localStorage.setItem('nd_equipped_skin', index);
        this.loadColors();
        UI.renderShop();
    },

    updateSize: function(newScale) {
        if(this.scale === newScale) return;
        let oldH = this.h;
        this.scale = newScale;
        this.w = 40 * this.scale;
        this.h = 40 * this.scale;
        
        if (this.g > 0) { this.y = this.y + (oldH - this.h); } 
        else { this.y = this.y - (oldH - this.h); }
        
        this.g = (CFG.g * newScale) * Math.sign(this.g);
    },

    reset: function(checkpoint) {
        if (checkpoint) {
            this.x = checkpoint.x; this.y = checkpoint.y; 
            this.g = checkpoint.g; this.scale = checkpoint.scale;
            this.mode = checkpoint.mode;
        } else {
            this.x = CFG.START_X * CFG.tile; this.y = 0; 
            this.g = CFG.g; this.scale = CFG.MACRO_SCALE;
            this.mode = 'cube';
        }
        
        this.dy=0; this.angle=0; 
        this.onGround=true;
        this.w = 40 * this.scale; this.h = 40 * this.scale;
        this.waveAngle = 0;
        this.isSwinging = false;
        this.swingBlock = null;
        this.dashTargetX = 0;
        Game.timeScale = 1.0;
        this.setMode(this.mode, true);
    },

    update: function() {
        if (this.x + this.w + this.dx > Game.goalX) { Game.win(); return; }

        const gravityFactor = this.scale * (this.g > 0 ? 1 : -1);
        const termScaled = CFG.term * this.scale;
        
        // 8-BLOCK HEIGHT LIMIT INSTANT DEATH FOR ALL MODES
        if (this.y > 0 || this.y - this.h < CFG.maxHeight) {
            Game.crash();
            return;
        }

        if (this.dashTargetX > this.x) {
            this.x += 60 * Game.timeScale; 
            if (this.x >= this.dashTargetX) {
                this.x = this.dashTargetX;
                this.dashTargetX = 0;
                Game.dashActive = false;
                this.dx = CFG.spd * Game.timeScale;
            }
        } else {
            this.dx = CFG.spd * Game.timeScale;
        }

        if(this.dashTargetX === 0) { 
            if(this.mode === 'cube' || this.mode === 'robot') {
                this.dy += CFG.g * gravityFactor * Game.timeScale;
                if(this.mode === 'cube') {
                    if(this.onGround) {
                        let r = Math.round(this.angle/(Math.PI/2))*(Math.PI/2);
                        this.angle += (r-this.angle)*0.25; 
                        
                        if (Input.held) {
                            this.jump(true); 
                        }
                    } else {
                        this.angle += 0.18 * Math.sign(this.g) * Game.timeScale;
                    }
                } else { 
                    this.angle += (0-this.angle)*0.1;
                }
            } 
            else if (this.mode === 'ship' || this.mode === 'ufo') {
                if(Input.held) this.dy -= (this.mode === 'ship' ? 0.6 : 0.7) * gravityFactor * Game.timeScale; 
                else this.dy += (this.mode === 'ship' ? 0.5 : CFG.g) * gravityFactor * Game.timeScale; 
                this.angle = this.dy * 0.15;
            } 
            else if (this.mode === 'wave') {
                if(Input.held) this.waveAngle = 45 * Math.sign(this.g);
                else this.waveAngle = -45 * Math.sign(this.g);
                
                const waveSpeed = 8 * this.scale;
                const waveRad = this.waveAngle * (Math.PI / 180);
                this.dy = Math.sin(waveRad) * -waveSpeed * Game.timeScale; 
                
                this.angle = waveRad * 1.5;
                this.dy += this.g * 0.0001; 
            }
            else if (this.mode === 'swing') {
                this.dy += CFG.g * gravityFactor * Game.timeScale;
                this.angle += (0-this.angle)*0.1; 
            }

            if (this.mode !== 'wave') {
                if(this.dy > termScaled) this.dy = termScaled;
                if(this.dy < -termScaled) this.dy = -termScaled;
            }
        }

        this.x += this.dx;
        this.checkCol(true);

        this.y += this.dy;
        this.onGround = false;

        const floorHeight = 0;
        const ceilingHeight = CFG.maxHeight;

        // 8-block height limit enforcement
        if(this.g > 0) { 
            if(this.y > floorHeight) { this.y = floorHeight; this.dy = 0; this.onGround = true; }
            if(this.y - this.h < ceilingHeight) { Game.crash(); return; }
        } else {
            if(this.y - this.h < ceilingHeight) { this.y = ceilingHeight + this.h; this.dy = 0; this.onGround = true; }
            if(this.y > floorHeight) { Game.crash(); return; }
        }

        this.checkCol(false);
    },

    checkCol: function(isX) {
        let l=this.x, r=this.x+this.w, t=this.y-this.h, b=this.y;
        
        for (let i = Game.level.length - 1; i >= 0; i--) {
            const o = Game.level[i];
            
            if(Math.abs(o.x*CFG.tile - this.x) > 100) continue; 

            let ox = o.x*CFG.tile, oy = -(o.y*CFG.tile);
            let ol = ox, or = ox+CFG.tile, ot = oy-CFG.tile, ob = oy;

            if(r>ol && l<or && b>ot && t<ob) {
                
                if(o.t===2) Game.crash();
                else if(o.t===3) { totalCoins++; AUDIO.coin(); Game.updateCoinDisplay(); Game.level.splice(i, 1); }
                else if(o.t===7) { 
                    const hitFromAbove = this.g > 0 && Math.abs(b - ot) < 20;
                    const hitFromBelow = this.g < 0 && Math.abs(t - ob) < 20;
                    const hitFromSide = Math.abs(l - or) < 10 || Math.abs(r - ol) < 10;
                    
                    if (hitFromAbove || hitFromBelow || hitFromSide) {
                        this.dy = (-CFG.PAD_JUMP * this.scale) * Math.sign(this.g); 
                        this.onGround=false; 
                        AUDIO.pad();
                    }
                }
                else if(o.t===13) { Game.setCheckpoint(this.x, this.y, this.g, this.mode, this.scale); Game.level.splice(i, 1); }
                else if(o.t===4) { this.setMode('ship'); Game.level.splice(i, 1); } 
                else if(o.t===5) { this.setMode('ufo'); Game.level.splice(i, 1); }
                else if(o.t===6) { this.setMode('cube'); Game.level.splice(i, 1); }
                else if(o.t===11) { this.setMode('wave'); Game.level.splice(i, 1); }
                else if(o.t===12) { this.setMode('robot'); Game.level.splice(i, 1); }
                else if(o.t===14) { this.setMode('swing'); Game.level.splice(i, 1); } 
                else if(o.t===15) { 
                    this.setMode('cube'); 
                    this.dash(); 
                    Game.level.splice(i, 1); 
                } 
                else if(o.t===16) { 
                    Game.applySlow(); 
                    Game.level.splice(i, 1);
                }
                else if(o.t===9) { this.updateSize(CFG.MINI_SCALE); this.g = Math.abs(CFG.g * this.scale) * Math.sign(this.g); Game.level.splice(i, 1); }
                else if(o.t===10) { this.updateSize(CFG.MACRO_SCALE); this.g = Math.abs(CFG.g * this.scale) * Math.sign(this.g); Game.level.splice(i, 1); }
                else if(o.t===1) { 
                    if(this.mode === 'wave') Game.crash(); 
                    if(isX) { Game.crash(); }
                    else {
                        let prevB = b - this.dy; 
                        let prevT = t - this.dy; 
                        let hitGround = false;

                        if (this.g > 0 && this.dy > 0 && prevB <= ot + 5) { this.y = ot; this.dy = 0; hitGround = true; } 
                        else if (this.g < 0 && this.dy < 0 && prevT >= ob - 5) { this.y = ob + this.h; this.dy = 0; hitGround = true; } 
                        else if (this.g > 0 && this.dy < 0 && prevT >= ob - 5) { this.y = ob + this.h; this.dy = 0; } 
                        else if (this.g < 0 && this.dy > 0 && prevB <= ot + 5) { this.y = ot; this.dy = 0; }
                        
                        if(hitGround && (this.mode === 'cube' || this.mode === 'robot' || this.mode === 'swing')) this.onGround = true;
                        
                        if(this.mode === 'swing' && this.isSwinging) { this.isSwinging = true; this.swingBlock = o; }
                    }
                }
            }
        }
    },
    
    dash: function() {
        if (this.mode === 'cube' && this.dashTargetX === 0) {
            this.dashTargetX = this.x + CFG.DASH_DIST * this.scale;
            this.dy = 0; 
            Game.dashActive = true;
            AUDIO.dash();
            Game.showTutorialMessage("DASH!", 500);
            
            // Create dash effect particles
            Effects.createDashEffect(this.x, this.y, this.mainColor);
        }
    },

    jump: function(continuous=false) {
        const jumpForce = CFG.jmp * this.scale;
        
        if((this.mode === 'cube' && this.onGround) || (this.mode === 'robot' && this.onGround)) {
            this.dy = -jumpForce * (this.mode === 'robot' ? 1.5 : 1.0) * Math.sign(this.g);
            this.onGround = false;
            AUDIO.jump();
            
            // Create jump effect particles
            Effects.createJumpEffect(this.x, this.y, this.mainColor);
        } 
    },

    setMode: function(m, force = false) {
        if(this.mode === m && !force) return;
        this.mode = m; 
        
        this.g = Math.abs(CFG.g * this.scale) * Math.sign(this.g); 
        this.isSwinging = false;
        this.swingBlock = null;

        if (m === 'cube' || m === 'robot' || m === 'swing') {
            this.dy = 0;
            this.onGround = true;
        }
        
        AUDIO.pad();
        const msg = document.getElementById('msg');
        let scaleText = this.scale < 1 ? ' (MINI)' : (this.scale > 1 ? ' (MACRO)' : '');
        msg.innerText = m.toUpperCase() + scaleText; 
        msg.style.opacity = 1;
        setTimeout(()=>msg.style.opacity=0, 1000);
        
        // Create mode change effect
        Effects.createModeChangeEffect(this.x, this.y, this.mainColor);
    },

    draw: function(ctx, camY) {
        ctx.save();
        let drawY = this.y + camY; 
        
        const playerCenterX = this.x - Game.camX + this.w/2;
        const playerCenterY = drawY - this.h/2;

        ctx.translate(playerCenterX, playerCenterY);
        ctx.rotate(this.angle);

        let displayMain = this.mainColor;
        
        ctx.fillStyle = displayMain;
        ctx.shadowBlur = 20;
        ctx.shadowColor = displayMain;

        const halfW = this.w / 2;
        const halfH = this.h / 2;
        
        if (this.mode === 'wave') { 
            ctx.beginPath();
            ctx.moveTo(-halfW, halfH);
            ctx.lineTo(halfW, halfH);
            ctx.lineTo(halfW, -halfH);
            ctx.lineTo(-halfW, -halfH);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = this.secondaryColor;
            ctx.lineWidth = 4;
            ctx.stroke();

        } else {
            ctx.fillRect(-halfW,-halfH,this.w,this.h);
            
            ctx.fillStyle = this.secondaryColor; 
            ctx.fillRect(-halfW * 0.5, -halfH * 0.5, halfW, halfH); 
            ctx.fillStyle = '#fff'; 
            ctx.fillRect(-halfW * 0.25, -halfH * 0.25, halfW * 0.5, halfH * 0.5); 
        }
        
        ctx.shadowBlur = 0;
        ctx.restore();
    }
};

// --- UI ---
const UI = {
    hide: () => document.querySelectorAll('.ui-layer').forEach(e => e.classList.replace('visible','hidden')),
    
    show: (id) => { 
        UI.hide();
        document.getElementById(id).classList.replace('hidden', 'visible');
    },
    
    home: () => { 
        Game.state = 'menu';
        document.getElementById('hud').style.display = 'none';
        document.getElementById('unlock-count').innerText = unlocked;
        document.getElementById('menu-coins').innerText = totalCoins;
        Game.checkMobileControls();
        AUDIO.stopBGM();
        Game.clearSlowTimer(); 
        UI.show('menu-main');
    },
    
    startPlay: () => { 
        UI.showLevels();
    },
    
    changeLevelPage: (direction) => {
        const maxPage = Math.ceil(CFG.TOTAL_LEVELS / CFG.LEVELS_PER_PAGE);
        currentPage = Math.min(maxPage, Math.max(1, currentPage + direction));
        UI.renderLevelGrid();
    },

    renderLevelGrid: () => {
        const grid = document.getElementById('lvl-grid');
        const prevBtn = document.getElementById('level-prev');
        const nextBtn = document.getElementById('level-next');

        grid.innerHTML = '';
        
        const start = (currentPage - 1) * CFG.LEVELS_PER_PAGE;
        const end = Math.min(CFG.TOTAL_LEVELS, start + CFG.LEVELS_PER_PAGE);

        for(let i=start; i<end; i++) {
            let b = document.createElement('div');
            b.innerText = i + 1; 
            b.className = 'lvl-btn';
            
            if(i + 1 > unlocked) {
                b.classList.add('locked');
            } else {
                b.classList.add('unlocked');
                b.onclick = () => Game.loadLevel(i); 
            }
            grid.appendChild(b);
        }
        
        for(let i=end; i<start + CFG.LEVELS_PER_PAGE; i++) {
            let b = document.createElement('div');
            b.innerText = '';
            b.className = 'lvl-btn locked';
            b.style.opacity = 0.2;
            grid.appendChild(b);
        }

        const maxPage = Math.ceil(CFG.TOTAL_LEVELS / CFG.LEVELS_PER_PAGE);
        prevBtn.disabled = currentPage <= 1;
        nextBtn.disabled = currentPage >= maxPage;
    },

    showLevels: () => {
        UI.renderLevelGrid();
        UI.show('menu-levels');
    },

    renderShop: function() {
        const shopContent = document.getElementById('shop-content');
        shopContent.innerHTML = '';

        SKINS.forEach((skin, index) => {
            const item = document.createElement('div');
            item.className = 'costume-item';

            const isUnlocked = unlockedSkins.includes(index);
            const isEquipped = equippedSkinIndex === index;

            if (isUnlocked) item.classList.add('unlocked');
            if (isEquipped) item.classList.add('equipped');

            const previewHTML = `
                <div class="costume-preview" style="border-color: ${skin.main};">
                    <div class="player-preview-cube" style="background-color:${skin.main}; border-color:${skin.secondary};">
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:15px; height:15px; background-color:${skin.secondary};"></div>
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:5px; height:5px; background-color:#fff;"></div>
                    </div>
                </div>
            `;
            
            let actionText = '';
            if (isEquipped) {
                actionText = '<span style="color:var(--neon-green); text-shadow: 0 0 10px var(--neon-green);">EQUIPPED</span>';
            } else if (isUnlocked) {
                actionText = 'Click to Equip';
            } else {
                actionText = `Cost: ${skin.cost} üí∞`;
            }

            item.innerHTML = `
                ${previewHTML}
                <strong style="color: ${skin.main};">${skin.name}</strong><br>
                <div class="cost">${actionText}</div>
            `;
            
            item.onclick = (e) => {
                e.stopPropagation(); 
                if (isUnlocked) {
                    Player.equipSkin(index);
                } else if (totalCoins >= skin.cost) {
                    totalCoins -= skin.cost;
                    unlockedSkins.push(index);
                    localStorage.setItem('nd_skins', JSON.stringify(unlockedSkins));
                    Game.updateCoinDisplay();
                    Player.equipSkin(index);
                } else {
                    alert(`Not enough coins! Requires ${skin.cost} üí∞.`);
                }
            };

            shopContent.appendChild(item);
        });
    },

    showShop: function() {
        UI.renderShop();
        UI.show('menu-shop');
    },

    showEditor: function() {
        UI.show('menu-editor');
    }
};

// --- LEVEL EDITOR ---
// --- LEVEL EDITOR ---
const LevelEditor = {
    isActive: false,
    currentTool: 1,
    levelData: [],
    isPlacing: false,
    gridSize: CFG.tile,

    init: function() {
        // Initialize editor tools
        const tools = document.querySelectorAll('.editor-tool');
        tools.forEach(tool => {
            tool.addEventListener('click', () => {
                tools.forEach(t => t.classList.remove('selected'));
                tool.classList.add('selected');
                this.currentTool = parseInt(tool.dataset.type);
            });
        });

        // Editor mouse events
        Game.canvas.addEventListener('mousedown', (e) => {
            if (!this.isActive) return;
            this.isPlacing = true;
            this.placeBlock(e);
        });

        Game.canvas.addEventListener('mousemove', (e) => {
            if (!this.isActive || !this.isPlacing) return;
            this.placeBlock(e);
        });

        Game.canvas.addEventListener('mouseup', () => {
            this.isPlacing = false;
        });

        // Touch events for mobile
        Game.canvas.addEventListener('touchstart', (e) => {
            if (!this.isActive) return;
            e.preventDefault();
            this.isPlacing = true;
            this.placeBlock(e.touches[0]);
        });

        Game.canvas.addEventListener('touchmove', (e) => {
            if (!this.isActive || !this.isPlacing) return;
            e.preventDefault();
            this.placeBlock(e.touches[0]);
        });

        Game.canvas.addEventListener('touchend', () => {
            this.isPlacing = false;
        });

        // Keyboard controls for camera movement in editor
        window.addEventListener('keydown', (e) => {
            if (!this.isActive) return;
            
            switch(e.code) {
                case 'ArrowLeft':
                    Game.camX -= 50;
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    Game.camX += 50;
                    e.preventDefault();
                    break;
                case 'ArrowUp':
                    Game.camX = 0; // Reset to start
                    e.preventDefault();
                    break;
                case 'Delete':
                case 'Backspace':
                    this.deleteAtCursor();
                    e.preventDefault();
                    break;
            }
        });
    },

    startNew: function() {
        this.isActive = true;
        this.levelData = [L(1,10,0), L(1,14,0), L(1,18,0), L(1,22,0), L(1,26,0)]; // Basic ground
        this.loadIntoGame();
        UI.hide();
        document.getElementById('editor-tools').style.display = 'flex';
        Game.state = 'editor';
        Game.camX = 0;
        
        // Show editor instructions
        Game.showTutorialMessage("Click/Touch to place blocks ‚Ä¢ Arrow keys to move camera ‚Ä¢ Delete to remove", 5000);
    },

    load: function() {
        const savedLevel = localStorage.getItem('nd_custom_level');
        if (savedLevel) {
            this.isActive = true;
            this.levelData = JSON.parse(savedLevel);
            this.loadIntoGame();
            UI.hide();
            document.getElementById('editor-tools').style.display = 'flex';
            Game.state = 'editor';
            Game.camX = 0;
        } else {
            alert('No saved level found! Create a new one.');
        }
    },

    loadIntoGame: function() {
        Game.level = JSON.parse(JSON.stringify(this.levelData));
        Game.level.push(L(99, 250, 0)); // Add goal
        Player.reset();
    },

    placeBlock: function(e) {
        const rect = Game.canvas.getBoundingClientRect();
        const x = e.clientX - rect.left + Game.camX;
        const y = e.clientY - rect.top;

        const gridX = Math.round(x / this.gridSize);
        const gridY = Math.round((Game.floorY - y) / this.gridSize);

        // Boundary checks
        if (gridX < 0 || gridX > 300 || gridY < -8 || gridY > 8) return;

        // Remove existing block at this position
        this.levelData = this.levelData.filter(block => 
            !(block.x === gridX && block.y === gridY)
        );

        // Add new block if not empty space (tool 0 would be eraser, but we don't have that)
        if (this.currentTool !== 0) {
            this.levelData.push(L(this.currentTool, gridX, gridY));
        }

        this.loadIntoGame();
    },

    deleteAtCursor: function() {
        // Get mouse position for deletion
        const mouseX = Input.mouseX + Game.camX;
        const mouseY = Input.mouseY;
        
        if (mouseX === undefined || mouseY === undefined) return;

        const gridX = Math.round(mouseX / this.gridSize);
        const gridY = Math.round((Game.floorY - mouseY) / this.gridSize);

        // Remove block at this position
        this.levelData = this.levelData.filter(block => 
            !(block.x === gridX && block.y === gridY)
        );

        this.loadIntoGame();
    },

    save: function() {
        localStorage.setItem('nd_custom_level', JSON.stringify(this.levelData));
        alert('Level saved successfully!');
    },

    exportLevel: function() {
        const levelJSON = JSON.stringify(this.levelData);
        const blob = new Blob([levelJSON], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'neon_dash_level.json';
        a.click();
        URL.revokeObjectURL(url);
    },

    importLevel: function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    this.levelData = JSON.parse(event.target.result);
                    this.loadIntoGame();
                    alert('Level imported successfully!');
                } catch (error) {
                    alert('Error importing level: Invalid file format');
                }
            };
            reader.readAsText(file);
        };
        input.click();
    },

    clearLevel: function() {
        if (confirm('Clear the entire level?')) {
            this.levelData = [];
            this.loadIntoGame();
        }
    },

    exitEditor: function() {
        this.isActive = false;
        document.getElementById('editor-tools').style.display = 'none';
        UI.home();
    }
};

// --- EFFECTS SYSTEM ---
const Effects = {
    particles: [],

    createParticle: function(x, y, color, velocityX, velocityY, life = 60) {
        this.particles.push({
            x: x,
            y: y,
            color: color,
            vx: velocityX,
            vy: velocityY,
            life: life,
            maxLife: life,
            size: Math.random() * 8 + 4
        });
    },

    createDashEffect: function(x, y, color) {
        for (let i = 0; i < 15; i++) {
            this.createParticle(
                x + Math.random() * 40,
                y + Math.random() * 40,
                color,
                (Math.random() - 0.5) * 20,
                (Math.random() - 0.5) * 20,
                30
            );
        }
    },

    createJumpEffect: function(x, y, color) {
        for (let i = 0; i < 8; i++) {
            this.createParticle(
                x + 20,
                y + 40,
                color,
                (Math.random() - 0.5) * 10,
                -Math.random() * 15,
                45
            );
        }
    },

    createModeChangeEffect: function(x, y, color) {
        for (let i = 0; i < 20; i++) {
            const angle = (i / 20) * Math.PI * 2;
            this.createParticle(
                x + 20,
                y + 20,
                color,
                Math.cos(angle) * 15,
                Math.sin(angle) * 15,
                60
            );
        }
    },

    update: function() {
        for (let i = this.particles.length - 1; i >= 0; i--) {
            const p = this.particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.5; // gravity
            p.life--;

            if (p.life <= 0) {
                this.particles.splice(i, 1);
            }
        }
    },

    draw: function(ctx, camY) {
        this.particles.forEach(p => {
            const alpha = p.life / p.maxLife;
            ctx.save();
            ctx.globalAlpha = alpha;
            ctx.fillStyle = p.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = p.color;
            ctx.beginPath();
            ctx.arc(p.x - Game.camX, p.y + camY, p.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        });
    }
};

// --- SCREEN TRANSITIONS ---
const Transitions = {
    element: document.getElementById('screen-transition'),

    show: function(callback) {
        this.element.classList.add('transition-active');
        setTimeout(() => {
            if (callback) callback();
            this.hide();
        }, 500);
    },

    hide: function() {
        setTimeout(() => {
            this.element.classList.remove('transition-active');
        }, 500);
    }
};

// --- INPUT ---
const action = () => { 
    if(Game.state === 'game') {
        Input.held=true; 
        AUDIO.init(); 
        
        if (Player.mode !== 'ship' && Player.mode !== 'ufo') {
            Player.jump(); 
        }
    }
};
const release = () => { Input.held=false; };

const isUIElement = (target) => {
    return target.closest('.ui-layer') || target.closest('.mobile-btn') || target.tagName === 'BUTTON' || target.classList.contains('lvl-btn') || target.classList.contains('costume-item') || target.closest('#editor-tools');
};

Input.touchStartAction = (e) => { 
    e.preventDefault(); 
    Input.mousePressed = true; 
    action(); 
};
Input.touchEndAction = (e) => { 
    e.preventDefault(); 
    Input.mousePressed = false; 
    release(); 
};

window.onkeydown = (e) => { 
    if(e.repeat) return; 
    
    if(e.code === 'Space' || e.code === 'ArrowUp') {
        e.preventDefault(); 
        action();
    }
    else if (e.code === 'KeyR') {
        Game.retry();
    }
    else if (e.code === 'Escape' && (Game.state==='game' || Game.state==='dead' || Game.state==='win')) {
        UI.home();
    }
};

window.onkeyup = (e) => { 
    if(e.code === 'Space' || e.code === 'ArrowUp') {
        release();
    }
};

window.onmousedown = (e) => {
    if(!isUIElement(e.target) && Game.state === 'game') {
        Input.mousePressed = true;
        action();
    }
};

window.onmousemove = (e) => {
    const rect = Game.canvas.getBoundingClientRect();
    Input.mouseX = e.clientX - rect.left;
    Input.mouseY = e.clientY - rect.top;
};

window.ontouchmove = (e) => {
    if (e.touches.length > 0) {
        const rect = Game.canvas.getBoundingClientRect();
        Input.mouseX = e.touches[0].clientX - rect.left;
        Input.mouseY = e.touches[0].clientY - rect.top;
    }
};

window.onmouseup = () => { 
    Input.mousePressed = false;
    release(); 
};

window.ontouchstart = (e) => {
    if (isUIElement(e.target)) return; 
    Input.mousePressed = true;
};

window.ontouchend = () => { 
    Input.mousePressed = false;
};

// Update game loop to include effects
const originalLoop = Game.loop;
Game.loop = function() {
    Effects.update();
    originalLoop.call(this);
    
    // Draw effects
    if (Game.state === 'game' || Game.state === 'editor') {
        Effects.draw(Game.ctx, Game.floorY - 150);
    }
};

Game.init();
</script>
</body>
</html>
